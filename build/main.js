(()=>{"use strict";class t{constructor(){this.container=document.createElement("div"),this.input=document.createElement("textarea"),this.input.setAttribute("spellcheck",!1),this.input.classList.add("textarea__input"),this.container.append(this.input),this.cursor=this.input.selectionStart,this.input.addEventListener("click",(()=>{this.cursor=this.input.selectionStart}))}addChar(t,e,n){if(t.key){let i;i="eng"===n?e&&t.onShift?t.onShift:t.key:e?t.langOnShift?t.langOnShift:t.onShift?t.onShift:t.lang?t.land:t.key:t.lang?t.lang:t.key,this.input.value=this.input.value.slice(0,this.cursor)+i+this.input.value.slice(this.cursor),this.cursor+=1}else"ArrowUp"===t.code&&this.setCursorUp(),"ArrowDown"===t.code&&this.setCursorDown(),"Backspace"===t.code?(this.input.value=this.input.value.slice(0,this.cursor-1)+this.input.value.slice(this.cursor),this.cursor-=1):"Delete"===t.code?this.input.value=this.input.value.slice(0,this.cursor)+this.input.value.slice(this.cursor+1):"ArrowLeft"===t.code?this.moveCursor("left"):"ArrowRight"===t.code&&this.moveCursor("right");this.setFocus()}setCursorUp(){const t=this.input.value.lastIndexOf("\n",this.cursor-1),e=this.cursor-t;if(e>=95||-1===t&&this.input.value.length>95)this.cursor-=95;else if(-1===t)this.cursor=0;else{const n=this.input.value.lastIndexOf("\n",t-1),i=t-n;this.cursor=i<e?t:n+e}this.input.setSelectionRange(this.cursor,this.cursor)}setCursorDown(){const t=this.input.value.lastIndexOf("\n",this.cursor-1),e=this.cursor-t,n=this.input.value.indexOf("\n",t+1);if(e>=95||-1===t&&this.input.value.length>95)this.cursor+=95;else if(-1===n)this.cursor=this.input.value.length;else{let t=this.input.value.indexOf("\n",n+1);-1===t&&(t=this.input.value.length);const i=t-n;this.cursor=i<e?n+i:n+e}this.input.setSelectionRange(this.cursor,this.cursor)}setFocus(){this.input.focus(),this.input.selectionStart=this.cursor,this.input.selectionEnd=this.cursor}moveCursor(t){"left"===t?this.cursor-=1:this.cursor+=1,this.setFocus()}}class e{constructor(t){switch(this.obj=t,this.container=document.createElement("div"),this.container.classList.add("key__container"),this.face=document.createElement("div"),this.face.classList.add("key__face"),this.text=document.createElement("p"),this.text.classList.add("key__text"),"char"===t.type?this.text.textContent=t.key:void 0!==t.name?this.text.textContent=t.name:this.text.textContent=t.code,this.face.append(this.text),t.size){case 2:this.container.classList.add("key__container_s");break;case 3:this.container.classList.add("key__container_event_m");break;case 4:this.container.classList.add("key__container_event_l");break;case 5:this.container.classList.add("key__container_event_xl");break;case 1:this.container.classList.add("key__container_xs")}this.container.append(this.face),"event"===t.type&&(t.isArrow?this.container.classList.add("key__container_arrow"):this.container.classList.add("key__container_event")),this.container.addEventListener("click",(()=>{"CapsLock"===t.code&&this.setOnMode();const e=new CustomEvent("custom-key",{bubbles:!0,detail:{obj:t,isCaps:this.isCaps}});this.container.dispatchEvent(e)})),this.container.addEventListener("mousedown",(()=>{this.container.classList.add("key__container_clicked"),this.container.classList.add("key__face_clicked"),this.toggleShift(t)})),this.container.addEventListener("mouseup",(()=>{this.toggleShift(t),setTimeout((()=>{this.container.classList.remove("key__container_clicked"),this.container.classList.remove("key__face_clicked")}),100)}))}setOnMode(){this.face.classList.toggle("key__face_on"),this.isCaps?this.isCaps=!1:this.isCaps=!0}toggleShift(t){if("ShiftLeft"===t.code){const e=new CustomEvent("shift-down",{bubbles:!0,detail:{obj:t}});this.container.dispatchEvent(e)}}}const n=JSON.parse('[{"code":"Backquote","key":"`","type":"char","onShift":"~","lang":"¨","langOnShift":"¸"},{"code":"Digit1","key":"1","type":"char","onShift":"!"},{"code":"Digit2","key":"2","type":"char","onShift":"@","langOnShift":"\\""},{"code":"Digit3","key":"3","type":"char","onShift":"#"},{"code":"Digit4","key":"4","type":"char","onShift":"$"},{"code":"Digit5","key":"5","type":"char","onShift":"%"},{"code":"Digit6","key":"6","type":"char","onShift":"^","langOnShift":"&"},{"code":"Digit7","key":"7","type":"char","onShift":"&","langOnShift":"/"},{"code":"Digit8","key":"8","type":"char","onShift":"*","langOnShift":"("},{"code":"Digit9","key":"9","type":"char","onShift":"(","langOnShift":")"},{"code":"Digit0","key":"0","type":"char","onShift":")","langOnShift":"="},{"code":"Minus","key":"-","type":"char","onShift":"_","lang":"\'","langOnShift":"?"},{"code":"Equal","key":"=","type":"char","onShift":"+","lang":"+","langOnShift":"*"},{"code":"Backspace","type":"event","size":3,"name":"⟵"},{"code":"Tab","type":"event","key":"\\t","size":2},{"code":"KeyQ","key":"q","type":"char","onShift":"Q"},{"code":"KeyW","key":"w","type":"char","onShift":"W"},{"code":"KeyE","key":"e","type":"char","onShift":"E"},{"code":"KeyR","key":"r","type":"char","onShift":"R"},{"code":"KeyT","key":"t","type":"char","onShift":"T"},{"code":"KeyY","key":"y","type":"char","onShift":"Y","lang":"z","langOnShift":"Z"},{"code":"KeyU","key":"u","type":"char","onShift":"U"},{"code":"KeyI","key":"i","type":"char","onShift":"I"},{"code":"KeyO","key":"o","type":"char","onShift":"O"},{"code":"KeyP","key":"p","type":"char","onShift":"P"},{"code":"BracketLeft","key":"[","type":"char","onShift":"{","lang":"š","langOnShift":"Š"},{"code":"BracketRight","key":"]","type":"char","onShift":"}","lang":"đ","langOnShift":"Đ"},{"code":"Backslash","key":"\\\\","type":"char","onShift":"|","lang":"ž","langOnShift":"Ž","size":2},{"code":"CapsLock","type":"event","size":3},{"code":"KeyA","key":"a","type":"char","onShift":"A"},{"code":"KeyS","key":"s","type":"char","onShift":"S"},{"code":"KeyD","key":"d","type":"char","onShift":"D"},{"code":"KeyF","key":"f","type":"char","onShift":"F"},{"code":"KeyG","key":"g","type":"char","onShift":"G"},{"code":"KeyH","key":"h","type":"char","onShift":"H"},{"code":"KeyJ","key":"j","type":"char","onShift":"J"},{"code":"KeyK","key":"k","type":"char","onShift":"K"},{"code":"KeyL","key":"l","type":"char","onShift":"L"},{"code":"Semicolon","key":";","type":"char","onShift":":","lang":"č","langOnShift":"Č"},{"code":"Quote","key":"\'","type":"char","onShift":"\\"","lang":"č","langOnShift":"Č"},{"code":"Enter","type":"event","key":"\\n","size":3},{"code":"ShiftLeft","type":"event","name":"shift","size":4},{"code":"KeyZ","key":"z","type":"char","onShift":"Z","lang":"y","langOnShift":"Y"},{"code":"KeyX","key":"x","type":"char","onShift":"X"},{"code":"KeyC","key":"c","type":"char","onShift":"C"},{"code":"KeyV","key":"v","type":"char","onShift":"V"},{"code":"KeyB","key":"b","type":"char","onShift":"B"},{"code":"KeyN","key":"n","type":"char","onShift":"N"},{"code":"KeyM","key":"m","type":"char","onShift":"M"},{"code":"Comma","key":",","type":"char","onShift":"<","langOnShift":";"},{"code":"Period","key":".","type":"char","onShift":">","langOnShift":":"},{"code":"Slash","key":"/","type":"char","onShift":"?","lang":"-","langOnShift":"_"},{"code":"ArrowUp","type":"event","name":"⇧","isArrow":true},{"code":"Delete","type":"event","name":"del","size":2},{"code":"ControlLeft","type":"event","name":"ctrl","size":1},{"code":"AltLeft","type":"event","name":"alt","size":1},{"code":"MetaLeft","type":"event","name":"⌘","size":1},{"code":"Space","type":"event","key":" ","name":"","size":5},{"code":"MetaRight","type":"event","name":"⌘","size":1},{"code":"ArrowLeft","type":"event","name":"⇦","isArrow":true},{"code":"ArrowDown","type":"event","name":"⇩","isArrow":true},{"code":"ArrowRight","type":"event","name":"⇨","isArrow":true}]');class i{constructor(){this.charKeysArr=[],this.keysArr=[],this.container=document.createElement("div"),this.container.classList.add("keyboard__container"),n.forEach((t=>{const n=new e(t);"char"===t.type&&this.charKeysArr.push(n),this.keysArr.push(n),this.container.append(n.container)}));const t=localStorage.getItem("lang");"eng"!==t&&this.changeNames(!1,t)}changeNames(t,e){this.charKeysArr.forEach((n=>{"eng"===e?t&&n.obj.onShift?n.text.textContent=n.obj.onShift:n.text.textContent=n.obj.key:t?n.obj.langOnShift?n.text.textContent=n.obj.langOnShift:n.text.textContent=n.obj.onShift:n.obj.lang?n.text.textContent=n.obj.lang:n.text.textContent=n.obj.key}))}}class s{constructor(){this.container=document.createElement("aside"),this.container.classList.add("hints__container");const t=document.createElement("h2");t.classList.add("hints__title"),t.textContent="Hot Keys",this.list=document.createElement("ul"),this.list.textContent="Change language:",this.list.classList.add("hints__list"),this.createListItem("For Mac: ","Control + ⌘ Command"),this.createListItem("For Windows: ","⇧ Shift + ⎵ Space");const e=document.createElement("p");e.classList.add("hints__text"),e.textContent="Keyboard was made on Mac OS",this.container.append(t,this.list,e)}createListItem(t,e){const n=document.createElement("li");n.classList.add("hints__item");const i=document.createElement("span");i.classList.add("hints__span"),i.textContent=t;const s=document.createElement("p");s.textContent=e,n.append(s),s.prepend(i),this.list.append(n)}}class a{constructor(){this.item=document.createElement("header"),this.item.classList.add("header");const t=document.createElement("h1");t.classList.add("header__title"),t.textContent="Virtual Keyboard";const e=document.createElement("p");e.classList.add("header__note"),e.textContent="Info";const n=new s,i=document.createElement("div");i.classList.add("header__cover"),this.item.append(t,e,n.container,i),e.addEventListener("click",(()=>{n.container.classList.toggle("hints__container_open")}))}}class o{constructor(){this.item=document.createElement("footer"),this.item.classList.add("footer");const t=document.createElement("p");t.classList.add("footer__text"),t.textContent="Layout:  ",this.eng=document.createElement("span"),this.eng.classList.add("footer__span"),this.eng.textContent="eng ",this.croat=document.createElement("span"),this.croat.classList.add("footer__span"),this.croat.textContent="HR/SRB",t.append(this.eng,this.croat);const e=localStorage.getItem("lang");this.lang=e||"eng","eng"!==this.lang?this.croat.classList.add("footer__span_selected"):this.eng.classList.add("footer__span_selected");const n=document.createElement("p");n.classList.add("footer__text","footer__link"),n.textContent="2023",this.item.append(t,n)}onLangChange(t){this.lang=t,this.croat.classList.toggle("footer__span_selected"),this.eng.classList.toggle("footer__span_selected")}}const c=document.querySelector("body"),h=new class{constructor(){this.container=document.createElement("div"),this.container.classList.add("app");const e=localStorage.getItem("lang");this.lang=e||"eng";const n=new a;this.footer=new o,this.textarea=new t,this.keyboard=new i,this.container.append(n.item,this.textarea.container,this.keyboard.container,this.footer.item),this.container.addEventListener("custom-key",(t=>{this.onVirtualKey(t.detail.isCaps,t.detail.obj),this.textarea.input.focus()})),this.container.addEventListener("shift-down",(t=>{this.isCaps=!this.isCaps,this.keyboard.changeNames(this.isCaps,this.lang),this.textarea.input.focus()})),document.addEventListener("keydown",(t=>{let e=this.keyboard.keysArr.find((e=>e.obj.code===t.code));"ShiftRight"===t.code&&(e=this.keyboard.keysArr.find((t=>"ShiftLeft"===t.obj.code))),e&&(e.container.classList.add("key__container_clicked"),t.ctrlKey&&t.metaKey||t.shiftKey&&"Space"===t.code?(t.preventDefault(),this.changeLang()):t.key&&(t.preventDefault(),this.onVirtualKey(e.isCaps,e.obj)),"CapsLock"===t.code&&(e.container.click(),this.onVirtualKey(!0,e.obj)),"ShiftLeft"!==t.code&&"ShiftRight"!==t.code||(this.isCaps?this.onVirtualKey(!1,e.obj):this.onVirtualKey(!0,e.obj)))})),document.addEventListener("keyup",(t=>{let e=this.keyboard.keysArr.find((e=>e.obj.code===t.code));"ShiftRight"===t.code&&(e=this.keyboard.keysArr.find((t=>"ShiftLeft"===t.obj.code))),e&&(e.container.classList.remove("key__container_clicked"),"CapsLock"===t.code&&(e.container.click(),this.onVirtualKey(!1,e.obj)),"ShiftLeft"!==t.code&&"ShiftRight"!==t.code||(this.isCaps?this.onVirtualKey(!1,e.obj):this.onVirtualKey(!0,e.obj)))}))}changeLang(){"eng"===this.lang?this.lang="hr":this.lang="eng",this.footer.onLangChange(this.lang),this.keyboard.changeNames(this.isCaps,this.lang),localStorage.setItem("lang",this.lang)}onVirtualKey(t,e){void 0!==t&&(this.isCaps=t,this.keyboard.changeNames(this.isCaps,this.lang)),this.textarea.addChar(e,this.isCaps,this.lang)}};c.append(h.container)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGFBQWF6RixLQUFLZSxNQUM5QmYsS0FBS2dHLFNBQVMzQixZQUFZckUsS0FBS2MsT0FBUWQsS0FBS2UsTUFDNUNvRCxhQUFhdUMsUUFBUSxPQUFRMUcsS0FBS2UsS0FDcEMsQ0FFQWtGLGFBQWFuRixFQUFRNkIsUUFDSkssSUFBWGxDLElBQ0ZkLEtBQUtjLE9BQVNBLEVBQ2RkLEtBQUtnRyxTQUFTM0IsWUFBWXJFLEtBQUtjLE9BQVFkLEtBQUtlLE9BRTlDZixLQUFLK0YsU0FBU25GLFFBQVErQixFQUFLM0MsS0FBS2MsT0FBUWQsS0FBS2UsS0FDL0MsR0R4R0YyRSxFQUFLbEYsT0FBT29GLEVBQUkzRixVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2NvbXBvbmVudHMvdGV4dGFyZWEvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbXBvbmVudHMva2V5L2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL2tleWJvYXJkL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL2hpbnRzL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL2hlYWRlci9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy9mb290ZXIvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9hcHAuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICcuL3N0eWxlLnNjc3MnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFRleHRhcmVhIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgIHRoaXMuaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZXh0YXJlYScpXG4gICAgdGhpcy5pbnB1dC5zZXRBdHRyaWJ1dGUoJ3NwZWxsY2hlY2snLCBmYWxzZSlcbiAgICB0aGlzLmlucHV0LmNsYXNzTGlzdC5hZGQoJ3RleHRhcmVhX19pbnB1dCcpXG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHRoaXMuaW5wdXQpXG5cbiAgICB0aGlzLmN1cnNvciA9IHRoaXMuaW5wdXQuc2VsZWN0aW9uU3RhcnRcbiAgICB0aGlzLmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgdGhpcy5jdXJzb3IgPSB0aGlzLmlucHV0LnNlbGVjdGlvblN0YXJ0XG4gICAgfSlcbiAgfVxuXG4gIGFkZENoYXIoa2V5SW5mbywgaXNDYXBzLCBsYW5nKSB7XG4gICAgaWYgKGtleUluZm8ua2V5KSB7XG4gICAgICBsZXQga2V5XG4gICAgICBpZiAobGFuZyA9PT0gJ2VuZycpIHtcbiAgICAgICAgaWYgKGlzQ2FwcyAmJiBrZXlJbmZvLm9uU2hpZnQpIHtcbiAgICAgICAgICBrZXkgPSBrZXlJbmZvLm9uU2hpZnRcbiAgICAgICAgfSBlbHNlIGtleSA9IGtleUluZm8ua2V5XG4gICAgICB9IGVsc2UgaWYgKGlzQ2Fwcykge1xuICAgICAgICBpZiAoa2V5SW5mby5sYW5nT25TaGlmdCkge1xuICAgICAgICAgIGtleSA9IGtleUluZm8ubGFuZ09uU2hpZnRcbiAgICAgICAgfSBlbHNlIGlmIChrZXlJbmZvLm9uU2hpZnQpIHtcbiAgICAgICAgICBrZXkgPSBrZXlJbmZvLm9uU2hpZnRcbiAgICAgICAgfSBlbHNlIGlmIChrZXlJbmZvLmxhbmcpIHtcbiAgICAgICAgICBrZXkgPSBrZXlJbmZvLmxhbmRcbiAgICAgICAgfSBlbHNlIGtleSA9IGtleUluZm8ua2V5XG4gICAgICB9IGVsc2UgaWYgKGtleUluZm8ubGFuZykge1xuICAgICAgICBrZXkgPSBrZXlJbmZvLmxhbmdcbiAgICAgIH0gZWxzZSBrZXkgPSBrZXlJbmZvLmtleVxuXG4gICAgICB0aGlzLmlucHV0LnZhbHVlID1cbiAgICAgICAgdGhpcy5pbnB1dC52YWx1ZS5zbGljZSgwLCB0aGlzLmN1cnNvcikgK1xuICAgICAgICBrZXkgK1xuICAgICAgICB0aGlzLmlucHV0LnZhbHVlLnNsaWNlKHRoaXMuY3Vyc29yKVxuICAgICAgdGhpcy5jdXJzb3IgKz0gMVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoa2V5SW5mby5jb2RlID09PSAnQXJyb3dVcCcpIHtcbiAgICAgICAgdGhpcy5zZXRDdXJzb3JVcCgpXG4gICAgICB9XG4gICAgICBpZiAoa2V5SW5mby5jb2RlID09PSAnQXJyb3dEb3duJykge1xuICAgICAgICB0aGlzLnNldEN1cnNvckRvd24oKVxuICAgICAgfVxuXG4gICAgICBpZiAoa2V5SW5mby5jb2RlID09PSAnQmFja3NwYWNlJykge1xuICAgICAgICB0aGlzLmlucHV0LnZhbHVlID1cbiAgICAgICAgICB0aGlzLmlucHV0LnZhbHVlLnNsaWNlKDAsIHRoaXMuY3Vyc29yIC0gMSkgK1xuICAgICAgICAgIHRoaXMuaW5wdXQudmFsdWUuc2xpY2UodGhpcy5jdXJzb3IpXG4gICAgICAgIHRoaXMuY3Vyc29yIC09IDFcbiAgICAgIH0gZWxzZSBpZiAoa2V5SW5mby5jb2RlID09PSAnRGVsZXRlJykge1xuICAgICAgICB0aGlzLmlucHV0LnZhbHVlID1cbiAgICAgICAgICB0aGlzLmlucHV0LnZhbHVlLnNsaWNlKDAsIHRoaXMuY3Vyc29yKSArXG4gICAgICAgICAgdGhpcy5pbnB1dC52YWx1ZS5zbGljZSh0aGlzLmN1cnNvciArIDEpXG4gICAgICB9IGVsc2UgaWYgKGtleUluZm8uY29kZSA9PT0gJ0Fycm93TGVmdCcpIHtcbiAgICAgICAgdGhpcy5tb3ZlQ3Vyc29yKCdsZWZ0JylcbiAgICAgIH0gZWxzZSBpZiAoa2V5SW5mby5jb2RlID09PSAnQXJyb3dSaWdodCcpIHtcbiAgICAgICAgdGhpcy5tb3ZlQ3Vyc29yKCdyaWdodCcpXG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zZXRGb2N1cygpXG4gIH1cblxuICBzZXRDdXJzb3JVcCgpIHtcbiAgICBjb25zdCBsaW5lU3RhcnQgPSB0aGlzLmlucHV0LnZhbHVlLmxhc3RJbmRleE9mKCdcXG4nLCB0aGlzLmN1cnNvciAtIDEpXG4gICAgY29uc3QgZ2FwID0gdGhpcy5jdXJzb3IgLSBsaW5lU3RhcnRcbiAgICBpZiAoZ2FwID49IDk1IHx8IChsaW5lU3RhcnQgPT09IC0xICYmIHRoaXMuaW5wdXQudmFsdWUubGVuZ3RoID4gOTUpKSB7XG4gICAgICB0aGlzLmN1cnNvciAtPSA5NVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAobGluZVN0YXJ0ID09PSAtMSkge1xuICAgICAgICB0aGlzLmN1cnNvciA9IDBcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHByZXZMaW5lU3RhcnQgPSB0aGlzLmlucHV0LnZhbHVlLmxhc3RJbmRleE9mKCdcXG4nLCBsaW5lU3RhcnQgLSAxKVxuICAgICAgICBjb25zdCBwcmV2TGluZUxlbmd0aCA9IGxpbmVTdGFydCAtIHByZXZMaW5lU3RhcnRcbiAgICAgICAgaWYgKHByZXZMaW5lTGVuZ3RoIDwgZ2FwKSB7XG4gICAgICAgICAgdGhpcy5jdXJzb3IgPSBsaW5lU3RhcnRcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmN1cnNvciA9IHByZXZMaW5lU3RhcnQgKyBnYXBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuaW5wdXQuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy5jdXJzb3IsIHRoaXMuY3Vyc29yKVxuICB9XG5cbiAgc2V0Q3Vyc29yRG93bigpIHtcbiAgICBjb25zdCBsaW5lU3RhcnQgPSB0aGlzLmlucHV0LnZhbHVlLmxhc3RJbmRleE9mKCdcXG4nLCB0aGlzLmN1cnNvciAtIDEpXG4gICAgY29uc3QgZ2FwID0gdGhpcy5jdXJzb3IgLSBsaW5lU3RhcnRcbiAgICBjb25zdCBuZXh0TGluZVN0YXJ0ID0gdGhpcy5pbnB1dC52YWx1ZS5pbmRleE9mKCdcXG4nLCBsaW5lU3RhcnQgKyAxKVxuICAgIGlmIChnYXAgPj0gOTUgfHwgKGxpbmVTdGFydCA9PT0gLTEgJiYgdGhpcy5pbnB1dC52YWx1ZS5sZW5ndGggPiA5NSkpIHtcbiAgICAgIHRoaXMuY3Vyc29yICs9IDk1XG4gICAgfSBlbHNlIGlmIChuZXh0TGluZVN0YXJ0ID09PSAtMSkge1xuICAgICAgdGhpcy5jdXJzb3IgPSB0aGlzLmlucHV0LnZhbHVlLmxlbmd0aFxuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgYWZ0ZXJOZXh0TGluZSA9IHRoaXMuaW5wdXQudmFsdWUuaW5kZXhPZignXFxuJywgbmV4dExpbmVTdGFydCArIDEpXG4gICAgICBpZiAoYWZ0ZXJOZXh0TGluZSA9PT0gLTEpIHtcbiAgICAgICAgYWZ0ZXJOZXh0TGluZSA9IHRoaXMuaW5wdXQudmFsdWUubGVuZ3RoXG4gICAgICB9XG4gICAgICBjb25zdCBuZXh0TGluZUxlbmd0aCA9IGFmdGVyTmV4dExpbmUgLSBuZXh0TGluZVN0YXJ0XG4gICAgICBpZiAobmV4dExpbmVMZW5ndGggPCBnYXApIHtcbiAgICAgICAgdGhpcy5jdXJzb3IgPSBuZXh0TGluZVN0YXJ0ICsgbmV4dExpbmVMZW5ndGhcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY3Vyc29yID0gbmV4dExpbmVTdGFydCArIGdhcFxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuaW5wdXQuc2V0U2VsZWN0aW9uUmFuZ2UodGhpcy5jdXJzb3IsIHRoaXMuY3Vyc29yKVxuICB9XG5cbiAgc2V0Rm9jdXMoKSB7XG4gICAgdGhpcy5pbnB1dC5mb2N1cygpXG4gICAgdGhpcy5pbnB1dC5zZWxlY3Rpb25TdGFydCA9IHRoaXMuY3Vyc29yXG4gICAgdGhpcy5pbnB1dC5zZWxlY3Rpb25FbmQgPSB0aGlzLmN1cnNvclxuICB9XG5cbiAgbW92ZUN1cnNvcihzaWRlKSB7XG4gICAgaWYgKHNpZGUgPT09ICdsZWZ0Jykge1xuICAgICAgdGhpcy5jdXJzb3IgLT0gMVxuICAgIH0gZWxzZSB0aGlzLmN1cnNvciArPSAxXG4gICAgdGhpcy5zZXRGb2N1cygpXG4gIH1cbn1cbiIsImltcG9ydCAnLi9zdHlsZS5zY3NzJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBLZXkge1xuICBjb25zdHJ1Y3RvcihrZXlPYmopIHtcbiAgICB0aGlzLm9iaiA9IGtleU9ialxuICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdrZXlfX2NvbnRhaW5lcicpXG4gICAgdGhpcy5mYWNlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLmZhY2UuY2xhc3NMaXN0LmFkZCgna2V5X19mYWNlJylcbiAgICB0aGlzLnRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJylcbiAgICB0aGlzLnRleHQuY2xhc3NMaXN0LmFkZCgna2V5X190ZXh0JylcbiAgICBpZiAoa2V5T2JqLnR5cGUgPT09ICdjaGFyJykge1xuICAgICAgdGhpcy50ZXh0LnRleHRDb250ZW50ID0ga2V5T2JqLmtleVxuICAgIH0gZWxzZSBpZiAoa2V5T2JqLm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy50ZXh0LnRleHRDb250ZW50ID0ga2V5T2JqLm5hbWVcbiAgICB9IGVsc2UgdGhpcy50ZXh0LnRleHRDb250ZW50ID0ga2V5T2JqLmNvZGVcbiAgICB0aGlzLmZhY2UuYXBwZW5kKHRoaXMudGV4dClcbiAgICBzd2l0Y2ggKGtleU9iai5zaXplKSB7XG4gICAgICBjYXNlIDI6XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2tleV9fY29udGFpbmVyX3MnKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSAzOlxuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdrZXlfX2NvbnRhaW5lcl9ldmVudF9tJylcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgNDpcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgna2V5X19jb250YWluZXJfZXZlbnRfbCcpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlIDU6XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2tleV9fY29udGFpbmVyX2V2ZW50X3hsJylcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgMTpcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgna2V5X19jb250YWluZXJfeHMnKVxuICAgICAgICBicmVha1xuICAgIH1cbiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQodGhpcy5mYWNlKVxuICAgIGlmIChrZXlPYmoudHlwZSA9PT0gJ2V2ZW50Jykge1xuICAgICAgaWYgKGtleU9iai5pc0Fycm93KSB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2tleV9fY29udGFpbmVyX2Fycm93JylcbiAgICAgIH0gZWxzZSB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdrZXlfX2NvbnRhaW5lcl9ldmVudCcpXG4gICAgfVxuXG4gICAgdGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBpZiAoa2V5T2JqLmNvZGUgPT09ICdDYXBzTG9jaycpIHtcbiAgICAgICAgdGhpcy5zZXRPbk1vZGUoKVxuICAgICAgfVxuICAgICAgY29uc3QgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ2N1c3RvbS1rZXknLCB7XG4gICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgIGRldGFpbDogeyBvYmo6IGtleU9iaiwgaXNDYXBzOiB0aGlzLmlzQ2FwcyB9LFxuICAgICAgfSlcbiAgICAgIHRoaXMuY29udGFpbmVyLmRpc3BhdGNoRXZlbnQoZXZlbnQpXG4gICAgfSlcblxuICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsICgpID0+IHtcbiAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2tleV9fY29udGFpbmVyX2NsaWNrZWQnKVxuICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgna2V5X19mYWNlX2NsaWNrZWQnKVxuICAgICAgdGhpcy50b2dnbGVTaGlmdChrZXlPYmopXG4gICAgfSlcblxuICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCAoKSA9PiB7XG4gICAgICB0aGlzLnRvZ2dsZVNoaWZ0KGtleU9iailcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdrZXlfX2NvbnRhaW5lcl9jbGlja2VkJylcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgna2V5X19mYWNlX2NsaWNrZWQnKVxuICAgICAgfSwgMTAwKVxuICAgIH0pXG4gIH1cblxuICBzZXRPbk1vZGUoKSB7XG4gICAgdGhpcy5mYWNlLmNsYXNzTGlzdC50b2dnbGUoJ2tleV9fZmFjZV9vbicpXG4gICAgaWYgKHRoaXMuaXNDYXBzKSB7XG4gICAgICB0aGlzLmlzQ2FwcyA9IGZhbHNlXG4gICAgfSBlbHNlIHRoaXMuaXNDYXBzID0gdHJ1ZVxuICB9XG5cbiAgdG9nZ2xlU2hpZnQoa2V5T2JqKSB7XG4gICAgaWYgKGtleU9iai5jb2RlID09PSAnU2hpZnRMZWZ0Jykge1xuICAgICAgY29uc3QgZXZlbnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ3NoaWZ0LWRvd24nLCB7XG4gICAgICAgIGJ1YmJsZXM6IHRydWUsXG4gICAgICAgIGRldGFpbDogeyBvYmo6IGtleU9iaiB9LFxuICAgICAgfSlcbiAgICAgIHRoaXMuY29udGFpbmVyLmRpc3BhdGNoRXZlbnQoZXZlbnQpXG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQgJy4vc3R5bGUuc2NzcydcbmltcG9ydCBLZXkgZnJvbSAnLi4va2V5J1xuaW1wb3J0IGtleXMgZnJvbSAnLi9rZXlzLmpzb24nXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEtleWJvYXJkIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jaGFyS2V5c0FyciA9IFtdXG4gICAgdGhpcy5rZXlzQXJyID0gW11cbiAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgna2V5Ym9hcmRfX2NvbnRhaW5lcicpXG4gICAga2V5cy5mb3JFYWNoKGUgPT4ge1xuICAgICAgY29uc3Qga2V5ID0gbmV3IEtleShlKVxuICAgICAgaWYgKGUudHlwZSA9PT0gJ2NoYXInKSB7XG4gICAgICAgIHRoaXMuY2hhcktleXNBcnIucHVzaChrZXkpXG4gICAgICB9XG4gICAgICB0aGlzLmtleXNBcnIucHVzaChrZXkpXG4gICAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoa2V5LmNvbnRhaW5lcilcbiAgICB9KVxuICAgIGNvbnN0IGxhbmcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZycpXG4gICAgaWYgKGxhbmcgIT09ICdlbmcnKSB0aGlzLmNoYW5nZU5hbWVzKGZhbHNlLCBsYW5nKVxuICB9XG5cbiAgY2hhbmdlTmFtZXMoaXNDYXBzLCBsYW5nKSB7XG4gICAgdGhpcy5jaGFyS2V5c0Fyci5mb3JFYWNoKGUgPT4ge1xuICAgICAgaWYgKGxhbmcgPT09ICdlbmcnKSB7XG4gICAgICAgIGlmIChpc0NhcHMgJiYgZS5vYmoub25TaGlmdCkge1xuICAgICAgICAgIGUudGV4dC50ZXh0Q29udGVudCA9IGUub2JqLm9uU2hpZnRcbiAgICAgICAgfSBlbHNlIGUudGV4dC50ZXh0Q29udGVudCA9IGUub2JqLmtleVxuICAgICAgfSBlbHNlIGlmIChpc0NhcHMpIHtcbiAgICAgICAgaWYgKGUub2JqLmxhbmdPblNoaWZ0KSB7XG4gICAgICAgICAgZS50ZXh0LnRleHRDb250ZW50ID0gZS5vYmoubGFuZ09uU2hpZnRcbiAgICAgICAgfSBlbHNlIGUudGV4dC50ZXh0Q29udGVudCA9IGUub2JqLm9uU2hpZnRcbiAgICAgIH0gZWxzZSBpZiAoZS5vYmoubGFuZykge1xuICAgICAgICBlLnRleHQudGV4dENvbnRlbnQgPSBlLm9iai5sYW5nXG4gICAgICB9IGVsc2UgZS50ZXh0LnRleHRDb250ZW50ID0gZS5vYmoua2V5XG4gICAgfSlcbiAgfVxufVxuIiwiaW1wb3J0ICcuL3N0eWxlLnNjc3MnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEhpbnRzIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhc2lkZScpXG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnaGludHNfX2NvbnRhaW5lcicpXG4gICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpXG4gICAgdGl0bGUuY2xhc3NMaXN0LmFkZCgnaGludHNfX3RpdGxlJylcbiAgICB0aXRsZS50ZXh0Q29udGVudCA9ICdIb3QgS2V5cydcbiAgICB0aGlzLmxpc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd1bCcpXG4gICAgdGhpcy5saXN0LnRleHRDb250ZW50ID0gJ0NoYW5nZSBsYW5ndWFnZTonXG4gICAgdGhpcy5saXN0LmNsYXNzTGlzdC5hZGQoJ2hpbnRzX19saXN0JylcbiAgICB0aGlzLmNyZWF0ZUxpc3RJdGVtKCdGb3IgTWFjOiAnLCAnQ29udHJvbCArIOKMmCBDb21tYW5kJylcbiAgICB0aGlzLmNyZWF0ZUxpc3RJdGVtKCdGb3IgV2luZG93czogJywgJ+KHpyBTaGlmdCArIOKOtSBTcGFjZScpXG4gICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKVxuICAgIHRleHQuY2xhc3NMaXN0LmFkZCgnaGludHNfX3RleHQnKVxuICAgIHRleHQudGV4dENvbnRlbnQgPSAnS2V5Ym9hcmQgd2FzIG1hZGUgb24gTWFjIE9TJ1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZCh0aXRsZSwgdGhpcy5saXN0LCB0ZXh0KVxuICB9XG5cbiAgY3JlYXRlTGlzdEl0ZW0oZmlyc3RUZXh0LCBzZWNvbmRUZXh0KSB7XG4gICAgY29uc3QgaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJylcbiAgICBpdGVtLmNsYXNzTGlzdC5hZGQoJ2hpbnRzX19pdGVtJylcbiAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpXG4gICAgc3Bhbi5jbGFzc0xpc3QuYWRkKCdoaW50c19fc3BhbicpXG4gICAgc3Bhbi50ZXh0Q29udGVudCA9IGZpcnN0VGV4dFxuICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJylcbiAgICB0ZXh0LnRleHRDb250ZW50ID0gc2Vjb25kVGV4dFxuICAgIGl0ZW0uYXBwZW5kKHRleHQpXG4gICAgdGV4dC5wcmVwZW5kKHNwYW4pXG4gICAgdGhpcy5saXN0LmFwcGVuZChpdGVtKVxuICB9XG59XG4iLCJpbXBvcnQgJy4vc3R5bGUuc2NzcydcbmltcG9ydCBIaW50cyBmcm9tICcuLi9oaW50cydcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSGVhZGVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5pdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaGVhZGVyJylcbiAgICB0aGlzLml0ZW0uY2xhc3NMaXN0LmFkZCgnaGVhZGVyJylcbiAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJylcbiAgICB0aXRsZS5jbGFzc0xpc3QuYWRkKCdoZWFkZXJfX3RpdGxlJylcbiAgICB0aXRsZS50ZXh0Q29udGVudCA9ICdWaXJ0dWFsIEtleWJvYXJkJ1xuICAgIGNvbnN0IG5vdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJylcbiAgICBub3RlLmNsYXNzTGlzdC5hZGQoJ2hlYWRlcl9fbm90ZScpXG4gICAgbm90ZS50ZXh0Q29udGVudCA9ICdJbmZvJ1xuICAgIGNvbnN0IGhpbnRzID0gbmV3IEhpbnRzKClcbiAgICBjb25zdCBjb3ZlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgY292ZXIuY2xhc3NMaXN0LmFkZCgnaGVhZGVyX19jb3ZlcicpXG4gICAgdGhpcy5pdGVtLmFwcGVuZCh0aXRsZSwgbm90ZSwgaGludHMuY29udGFpbmVyLCBjb3ZlcilcbiAgICBub3RlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgaGludHMuY29udGFpbmVyLmNsYXNzTGlzdC50b2dnbGUoJ2hpbnRzX19jb250YWluZXJfb3BlbicpXG4gICAgfSlcbiAgfVxufVxuIiwiaW1wb3J0ICcuL3N0eWxlLnNjc3MnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvb3RlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2Zvb3RlcicpXG4gICAgdGhpcy5pdGVtLmNsYXNzTGlzdC5hZGQoJ2Zvb3RlcicpXG4gICAgY29uc3QgdGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKVxuICAgIHRleHQuY2xhc3NMaXN0LmFkZCgnZm9vdGVyX190ZXh0JylcbiAgICB0ZXh0LnRleHRDb250ZW50ID0gJ0xheW91dDogICdcbiAgICB0aGlzLmVuZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxuICAgIHRoaXMuZW5nLmNsYXNzTGlzdC5hZGQoJ2Zvb3Rlcl9fc3BhbicpXG4gICAgdGhpcy5lbmcudGV4dENvbnRlbnQgPSAnZW5nICdcbiAgICB0aGlzLmNyb2F0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpXG4gICAgdGhpcy5jcm9hdC5jbGFzc0xpc3QuYWRkKCdmb290ZXJfX3NwYW4nKVxuICAgIHRoaXMuY3JvYXQudGV4dENvbnRlbnQgPSAnSFIvU1JCJ1xuICAgIHRleHQuYXBwZW5kKHRoaXMuZW5nLCB0aGlzLmNyb2F0KVxuICAgIGNvbnN0IHByZXZMYW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmcnKVxuICAgIGlmIChwcmV2TGFuZykge1xuICAgICAgdGhpcy5sYW5nID0gcHJldkxhbmdcbiAgICB9IGVsc2UgdGhpcy5sYW5nID0gJ2VuZydcbiAgICBpZiAodGhpcy5sYW5nICE9PSAnZW5nJykge1xuICAgICAgdGhpcy5jcm9hdC5jbGFzc0xpc3QuYWRkKCdmb290ZXJfX3NwYW5fc2VsZWN0ZWQnKVxuICAgIH0gZWxzZSB0aGlzLmVuZy5jbGFzc0xpc3QuYWRkKCdmb290ZXJfX3NwYW5fc2VsZWN0ZWQnKVxuICAgIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJylcbiAgICBkYXRlLmNsYXNzTGlzdC5hZGQoJ2Zvb3Rlcl9fdGV4dCcsICdmb290ZXJfX2xpbmsnKVxuICAgIGRhdGUudGV4dENvbnRlbnQgPSAnMjAyMydcbiAgICB0aGlzLml0ZW0uYXBwZW5kKHRleHQsIGRhdGUpXG4gIH1cblxuICBvbkxhbmdDaGFuZ2UobGFuZykge1xuICAgIHRoaXMubGFuZyA9IGxhbmdcbiAgICB0aGlzLmNyb2F0LmNsYXNzTGlzdC50b2dnbGUoJ2Zvb3Rlcl9fc3Bhbl9zZWxlY3RlZCcpXG4gICAgdGhpcy5lbmcuY2xhc3NMaXN0LnRvZ2dsZSgnZm9vdGVyX19zcGFuX3NlbGVjdGVkJylcbiAgfVxufVxuIiwiaW1wb3J0ICcuL3N0eWxlLnNjc3MnXG5pbXBvcnQgQXBwIGZyb20gJy4vYXBwJ1xuXG5jb25zdCByb290ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpXG5jb25zdCBhcHAgPSBuZXcgQXBwKClcbnJvb3QuYXBwZW5kKGFwcC5jb250YWluZXIpXG4iLCJpbXBvcnQgJy4vc3R5bGUuc2NzcydcbmltcG9ydCBUZXh0YXJlYSBmcm9tICcuL2NvbXBvbmVudHMvdGV4dGFyZWEnXG5pbXBvcnQgS2V5Ym9hcmQgZnJvbSAnLi9jb21wb25lbnRzL2tleWJvYXJkJ1xuaW1wb3J0IEhlYWRlciBmcm9tICcuL2NvbXBvbmVudHMvaGVhZGVyJ1xuaW1wb3J0IEZvb3RlciBmcm9tICcuL2NvbXBvbmVudHMvZm9vdGVyJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBBcHAge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgnYXBwJylcbiAgICBjb25zdCBwcmV2TGFuZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsYW5nJylcbiAgICBpZiAocHJldkxhbmcpIHtcbiAgICAgIHRoaXMubGFuZyA9IHByZXZMYW5nXG4gICAgfSBlbHNlIHRoaXMubGFuZyA9ICdlbmcnXG5cbiAgICBjb25zdCBoZWFkZXIgPSBuZXcgSGVhZGVyKClcbiAgICB0aGlzLmZvb3RlciA9IG5ldyBGb290ZXIoKVxuXG4gICAgdGhpcy50ZXh0YXJlYSA9IG5ldyBUZXh0YXJlYSgpXG4gICAgdGhpcy5rZXlib2FyZCA9IG5ldyBLZXlib2FyZCgpXG5cbiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQoXG4gICAgICBoZWFkZXIuaXRlbSxcbiAgICAgIHRoaXMudGV4dGFyZWEuY29udGFpbmVyLFxuICAgICAgdGhpcy5rZXlib2FyZC5jb250YWluZXIsXG4gICAgICB0aGlzLmZvb3Rlci5pdGVtXG4gICAgKVxuXG4gICAgdGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY3VzdG9tLWtleScsIGUgPT4ge1xuICAgICAgdGhpcy5vblZpcnR1YWxLZXkoZS5kZXRhaWwuaXNDYXBzLCBlLmRldGFpbC5vYmopXG4gICAgICB0aGlzLnRleHRhcmVhLmlucHV0LmZvY3VzKClcbiAgICB9KVxuXG4gICAgdGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignc2hpZnQtZG93bicsIGUgPT4ge1xuICAgICAgdGhpcy5pc0NhcHMgPSAhdGhpcy5pc0NhcHNcbiAgICAgIHRoaXMua2V5Ym9hcmQuY2hhbmdlTmFtZXModGhpcy5pc0NhcHMsIHRoaXMubGFuZylcbiAgICAgIHRoaXMudGV4dGFyZWEuaW5wdXQuZm9jdXMoKVxuICAgIH0pXG5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZXZlbnQgPT4ge1xuICAgICAgbGV0IHZpcnR1YWxLZXkgPSB0aGlzLmtleWJvYXJkLmtleXNBcnIuZmluZChcbiAgICAgICAgZSA9PiBlLm9iai5jb2RlID09PSBldmVudC5jb2RlXG4gICAgICApXG4gICAgICBpZiAoZXZlbnQuY29kZSA9PT0gJ1NoaWZ0UmlnaHQnKSB7XG4gICAgICAgIHZpcnR1YWxLZXkgPSB0aGlzLmtleWJvYXJkLmtleXNBcnIuZmluZChlID0+IGUub2JqLmNvZGUgPT09ICdTaGlmdExlZnQnKVxuICAgICAgfVxuICAgICAgaWYgKHZpcnR1YWxLZXkpIHtcbiAgICAgICAgdmlydHVhbEtleS5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgna2V5X19jb250YWluZXJfY2xpY2tlZCcpXG4gICAgICAgIGlmIChcbiAgICAgICAgICAoZXZlbnQuY3RybEtleSAmJiBldmVudC5tZXRhS2V5KSB8fFxuICAgICAgICAgIChldmVudC5zaGlmdEtleSAmJiBldmVudC5jb2RlID09PSAnU3BhY2UnKVxuICAgICAgICApIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgdGhpcy5jaGFuZ2VMYW5nKClcbiAgICAgICAgfSBlbHNlIGlmIChldmVudC5rZXkpIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgdGhpcy5vblZpcnR1YWxLZXkodmlydHVhbEtleS5pc0NhcHMsIHZpcnR1YWxLZXkub2JqKVxuICAgICAgICB9XG4gICAgICAgIGlmIChldmVudC5jb2RlID09PSAnQ2Fwc0xvY2snKSB7XG4gICAgICAgICAgdmlydHVhbEtleS5jb250YWluZXIuY2xpY2soKVxuICAgICAgICAgIHRoaXMub25WaXJ0dWFsS2V5KHRydWUsIHZpcnR1YWxLZXkub2JqKVxuICAgICAgICB9XG4gICAgICAgIGlmIChldmVudC5jb2RlID09PSAnU2hpZnRMZWZ0JyB8fCBldmVudC5jb2RlID09PSAnU2hpZnRSaWdodCcpIHtcbiAgICAgICAgICBpZiAodGhpcy5pc0NhcHMpIHtcbiAgICAgICAgICAgIHRoaXMub25WaXJ0dWFsS2V5KGZhbHNlLCB2aXJ0dWFsS2V5Lm9iailcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5vblZpcnR1YWxLZXkodHJ1ZSwgdmlydHVhbEtleS5vYmopXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZXZlbnQgPT4ge1xuICAgICAgbGV0IHZpcnR1YWxLZXkgPSB0aGlzLmtleWJvYXJkLmtleXNBcnIuZmluZChcbiAgICAgICAgZSA9PiBlLm9iai5jb2RlID09PSBldmVudC5jb2RlXG4gICAgICApXG4gICAgICBpZiAoZXZlbnQuY29kZSA9PT0gJ1NoaWZ0UmlnaHQnKSB7XG4gICAgICAgIHZpcnR1YWxLZXkgPSB0aGlzLmtleWJvYXJkLmtleXNBcnIuZmluZChlID0+IGUub2JqLmNvZGUgPT09ICdTaGlmdExlZnQnKVxuICAgICAgfVxuICAgICAgaWYgKHZpcnR1YWxLZXkpIHtcbiAgICAgICAgdmlydHVhbEtleS5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgna2V5X19jb250YWluZXJfY2xpY2tlZCcpXG4gICAgICAgIGlmIChldmVudC5jb2RlID09PSAnQ2Fwc0xvY2snKSB7XG4gICAgICAgICAgdmlydHVhbEtleS5jb250YWluZXIuY2xpY2soKVxuICAgICAgICAgIHRoaXMub25WaXJ0dWFsS2V5KGZhbHNlLCB2aXJ0dWFsS2V5Lm9iailcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXZlbnQuY29kZSA9PT0gJ1NoaWZ0TGVmdCcgfHwgZXZlbnQuY29kZSA9PT0gJ1NoaWZ0UmlnaHQnKSB7XG4gICAgICAgICAgaWYgKHRoaXMuaXNDYXBzKSB7XG4gICAgICAgICAgICB0aGlzLm9uVmlydHVhbEtleShmYWxzZSwgdmlydHVhbEtleS5vYmopXG4gICAgICAgICAgfSBlbHNlIHRoaXMub25WaXJ0dWFsS2V5KHRydWUsIHZpcnR1YWxLZXkub2JqKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfVxuXG4gIGNoYW5nZUxhbmcoKSB7XG4gICAgaWYgKHRoaXMubGFuZyA9PT0gJ2VuZycpIHtcbiAgICAgIHRoaXMubGFuZyA9ICdocidcbiAgICB9IGVsc2UgdGhpcy5sYW5nID0gJ2VuZydcbiAgICB0aGlzLmZvb3Rlci5vbkxhbmdDaGFuZ2UodGhpcy5sYW5nKVxuICAgIHRoaXMua2V5Ym9hcmQuY2hhbmdlTmFtZXModGhpcy5pc0NhcHMsIHRoaXMubGFuZylcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbGFuZycsIHRoaXMubGFuZylcbiAgfVxuXG4gIG9uVmlydHVhbEtleShpc0NhcHMsIG9iaikge1xuICAgIGlmIChpc0NhcHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5pc0NhcHMgPSBpc0NhcHNcbiAgICAgIHRoaXMua2V5Ym9hcmQuY2hhbmdlTmFtZXModGhpcy5pc0NhcHMsIHRoaXMubGFuZylcbiAgICB9XG4gICAgdGhpcy50ZXh0YXJlYS5hZGRDaGFyKG9iaiwgdGhpcy5pc0NhcHMsIHRoaXMubGFuZylcbiAgfVxufVxuIl0sIm5hbWVzIjpbIlRleHRhcmVhIiwiY29uc3RydWN0b3IiLCJ0aGlzIiwiY29udGFpbmVyIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaW5wdXQiLCJzZXRBdHRyaWJ1dGUiLCJjbGFzc0xpc3QiLCJhZGQiLCJhcHBlbmQiLCJjdXJzb3IiLCJzZWxlY3Rpb25TdGFydCIsImFkZEV2ZW50TGlzdGVuZXIiLCJhZGRDaGFyIiwia2V5SW5mbyIsImlzQ2FwcyIsImxhbmciLCJrZXkiLCJvblNoaWZ0IiwibGFuZ09uU2hpZnQiLCJsYW5kIiwidmFsdWUiLCJzbGljZSIsImNvZGUiLCJzZXRDdXJzb3JVcCIsInNldEN1cnNvckRvd24iLCJtb3ZlQ3Vyc29yIiwic2V0Rm9jdXMiLCJsaW5lU3RhcnQiLCJsYXN0SW5kZXhPZiIsImdhcCIsImxlbmd0aCIsInByZXZMaW5lU3RhcnQiLCJwcmV2TGluZUxlbmd0aCIsInNldFNlbGVjdGlvblJhbmdlIiwibmV4dExpbmVTdGFydCIsImluZGV4T2YiLCJhZnRlck5leHRMaW5lIiwibmV4dExpbmVMZW5ndGgiLCJmb2N1cyIsInNlbGVjdGlvbkVuZCIsInNpZGUiLCJLZXkiLCJrZXlPYmoiLCJvYmoiLCJmYWNlIiwidGV4dCIsInR5cGUiLCJ0ZXh0Q29udGVudCIsInVuZGVmaW5lZCIsIm5hbWUiLCJzaXplIiwiaXNBcnJvdyIsInNldE9uTW9kZSIsImV2ZW50IiwiQ3VzdG9tRXZlbnQiLCJidWJibGVzIiwiZGV0YWlsIiwiZGlzcGF0Y2hFdmVudCIsInRvZ2dsZVNoaWZ0Iiwic2V0VGltZW91dCIsInJlbW92ZSIsInRvZ2dsZSIsIktleWJvYXJkIiwiY2hhcktleXNBcnIiLCJrZXlzQXJyIiwiZSIsInB1c2giLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiY2hhbmdlTmFtZXMiLCJmb3JFYWNoIiwiSGludHMiLCJ0aXRsZSIsImxpc3QiLCJjcmVhdGVMaXN0SXRlbSIsImZpcnN0VGV4dCIsInNlY29uZFRleHQiLCJpdGVtIiwic3BhbiIsInByZXBlbmQiLCJIZWFkZXIiLCJub3RlIiwiaGludHMiLCJjb3ZlciIsIkZvb3RlciIsImVuZyIsImNyb2F0IiwicHJldkxhbmciLCJkYXRlIiwib25MYW5nQ2hhbmdlIiwicm9vdCIsInF1ZXJ5U2VsZWN0b3IiLCJhcHAiLCJoZWFkZXIiLCJmb290ZXIiLCJ0ZXh0YXJlYSIsImtleWJvYXJkIiwib25WaXJ0dWFsS2V5IiwidmlydHVhbEtleSIsImZpbmQiLCJjdHJsS2V5IiwibWV0YUtleSIsInNoaWZ0S2V5IiwicHJldmVudERlZmF1bHQiLCJjaGFuZ2VMYW5nIiwiY2xpY2siLCJzZXRJdGVtIl0sInNvdXJjZVJvb3QiOiIifQ==