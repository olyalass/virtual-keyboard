(()=>{"use strict";class t{constructor(){this.container=document.createElement("div"),this.input=document.createElement("textarea"),this.input.setAttribute("spellcheck",!1),this.input.classList.add("textarea__input"),this.container.append(this.input),this.cursor=this.input.selectionStart,this.input.addEventListener("click",(()=>{this.cursor=this.input.selectionStart}))}addChar(t,e,n){if(t.key){let i;i="eng"===n?e&&t.onShift?t.onShift:t.key:e?t.langOnShift?t.langOnShift:t.onShift?t.onShift:t.lang?t.land:t.key:t.lang?t.lang:t.key,this.input.value=this.input.value.slice(0,this.cursor)+i+this.input.value.slice(this.cursor),this.cursor+=1}else"ArrowUp"===t.code&&this.setCursorUp(),"ArrowDown"===t.code&&this.setCursorDown(),"Backspace"===t.code?(this.input.value=this.input.value.slice(0,this.cursor-1)+this.input.value.slice(this.cursor),this.cursor-=1):"Delete"===t.code?this.input.value=this.input.value.slice(0,this.cursor)+this.input.value.slice(this.cursor+1):"ArrowLeft"===t.code?this.moveCursor("left"):"ArrowRight"===t.code&&this.moveCursor("right");this.setFocus()}setCursorUp(){const t=this.input.value.lastIndexOf("\n",this.cursor-1),e=this.cursor-t;if(e>=95||-1===t&&this.input.value.length>95)this.cursor-=95;else if(-1===t)this.cursor=0;else{const n=this.input.value.lastIndexOf("\n",t-1),i=t-n;this.cursor=i<e?t:n+e}this.input.setSelectionRange(this.cursor,this.cursor)}setCursorDown(){const t=this.input.value.lastIndexOf("\n",this.cursor-1),e=this.cursor-t,n=this.input.value.indexOf("\n",t+1);if(e>=95||-1===t&&this.input.value.length>95)this.cursor+=95;else if(-1===n)this.cursor=this.input.value.length;else{let t=this.input.value.indexOf("\n",n+1);-1===t&&(t=this.input.value.length);const i=t-n;this.cursor=i<e?n+i:n+e}this.input.setSelectionRange(this.cursor,this.cursor)}setFocus(){this.input.focus(),this.input.selectionStart=this.cursor,this.input.selectionEnd=this.cursor}moveCursor(t){"left"===t?this.cursor-=1:this.cursor+=1,this.setFocus()}}class e{constructor(t){switch(this.obj=t,this.container=document.createElement("div"),this.container.classList.add("key__container"),this.face=document.createElement("div"),this.face.classList.add("key__face"),this.text=document.createElement("p"),this.text.classList.add("key__text"),"char"===t.type?this.text.textContent=t.key:void 0!==t.name?this.text.textContent=t.name:this.text.textContent=t.code,this.face.append(this.text),t.size){case 2:this.container.classList.add("key__container_s");break;case 3:this.container.classList.add("key__container_event_m");break;case 4:this.container.classList.add("key__container_event_l");break;case 5:this.container.classList.add("key__container_event_xl");break;case 1:this.container.classList.add("key__container_xs")}this.container.append(this.face),"event"===t.type&&(t.isArrow?this.container.classList.add("key__container_arrow"):this.container.classList.add("key__container_event")),this.container.addEventListener("click",(()=>{"CapsLock"===t.code&&this.setOnMode();const e=new CustomEvent("custom-key",{bubbles:!0,detail:{obj:t,isCaps:this.isCaps}});this.container.dispatchEvent(e)})),this.container.addEventListener("mousedown",(()=>{this.container.classList.add("key__container_clicked"),this.container.classList.add("key__face_clicked"),this.toggleShift(t)})),this.container.addEventListener("mouseup",(()=>{this.toggleShift(t),setTimeout((()=>{this.container.classList.remove("key__container_clicked"),this.container.classList.remove("key__face_clicked")}),100)}))}setOnMode(){this.face.classList.toggle("key__face_on"),this.isCaps?this.isCaps=!1:this.isCaps=!0}toggleShift(t){if("ShiftLeft"===t.code){const e=new CustomEvent("shift-down",{bubbles:!0,detail:{obj:t}});this.container.dispatchEvent(e)}}}const n=JSON.parse('[{"code":"Backquote","key":"`","type":"char","onShift":"~","lang":"¨","langOnShift":"¸"},{"code":"Digit1","key":"1","type":"char","onShift":"!"},{"code":"Digit2","key":"2","type":"char","onShift":"@","langOnShift":"\\""},{"code":"Digit3","key":"3","type":"char","onShift":"#"},{"code":"Digit4","key":"4","type":"char","onShift":"$"},{"code":"Digit5","key":"5","type":"char","onShift":"%"},{"code":"Digit6","key":"6","type":"char","onShift":"^","langOnShift":"&"},{"code":"Digit7","key":"7","type":"char","onShift":"&","langOnShift":"/"},{"code":"Digit8","key":"8","type":"char","onShift":"*","langOnShift":"("},{"code":"Digit9","key":"9","type":"char","onShift":"(","langOnShift":")"},{"code":"Digit0","key":"0","type":"char","onShift":")","langOnShift":"="},{"code":"Minus","key":"-","type":"char","onShift":"_","lang":"\'","langOnShift":"?"},{"code":"Equal","key":"=","type":"char","onShift":"+","lang":"+","langOnShift":"*"},{"code":"Backspace","type":"event","size":3,"name":"⟵"},{"code":"Tab","type":"event","key":"\\t","size":2},{"code":"KeyQ","key":"q","type":"char","onShift":"Q"},{"code":"KeyW","key":"w","type":"char","onShift":"W"},{"code":"KeyE","key":"e","type":"char","onShift":"E"},{"code":"KeyR","key":"r","type":"char","onShift":"R"},{"code":"KeyT","key":"t","type":"char","onShift":"T"},{"code":"KeyY","key":"y","type":"char","onShift":"Y","lang":"z","langOnShift":"Z"},{"code":"KeyU","key":"u","type":"char","onShift":"U"},{"code":"KeyI","key":"i","type":"char","onShift":"I"},{"code":"KeyO","key":"o","type":"char","onShift":"O"},{"code":"KeyP","key":"p","type":"char","onShift":"P"},{"code":"BracketLeft","key":"[","type":"char","onShift":"{","lang":"š","langOnShift":"Š"},{"code":"BracketRight","key":"]","type":"char","onShift":"}","lang":"đ","langOnShift":"Đ"},{"code":"Backslash","key":"\\\\","type":"char","onShift":"|","lang":"ž","langOnShift":"Ž","size":2},{"code":"CapsLock","type":"event","size":3},{"code":"KeyA","key":"a","type":"char","onShift":"A"},{"code":"KeyS","key":"s","type":"char","onShift":"S"},{"code":"KeyD","key":"d","type":"char","onShift":"D"},{"code":"KeyF","key":"f","type":"char","onShift":"F"},{"code":"KeyG","key":"g","type":"char","onShift":"G"},{"code":"KeyH","key":"h","type":"char","onShift":"H"},{"code":"KeyJ","key":"j","type":"char","onShift":"J"},{"code":"KeyK","key":"k","type":"char","onShift":"K"},{"code":"KeyL","key":"l","type":"char","onShift":"L"},{"code":"Semicolon","key":";","type":"char","onShift":":","lang":"č","langOnShift":"Č"},{"code":"Quote","key":"\'","type":"char","onShift":"\\"","lang":"č","langOnShift":"Č"},{"code":"Enter","type":"event","key":"\\n","size":3},{"code":"ShiftLeft","type":"event","name":"shift","size":4},{"code":"KeyZ","key":"z","type":"char","onShift":"Z","lang":"y","langOnShift":"Y"},{"code":"KeyX","key":"x","type":"char","onShift":"X"},{"code":"KeyC","key":"c","type":"char","onShift":"C"},{"code":"KeyV","key":"v","type":"char","onShift":"V"},{"code":"KeyB","key":"b","type":"char","onShift":"B"},{"code":"KeyN","key":"n","type":"char","onShift":"N"},{"code":"KeyM","key":"m","type":"char","onShift":"M"},{"code":"Comma","key":",","type":"char","onShift":"<","langOnShift":";"},{"code":"Period","key":".","type":"char","onShift":">","langOnShift":":"},{"code":"Slash","key":"/","type":"char","onShift":"?","lang":"-","langOnShift":"_"},{"code":"ArrowUp","type":"event","name":"⇧","isArrow":true},{"code":"Delete","type":"event","name":"del","size":2},{"code":"ControlLeft","type":"event","name":"ctrl","size":1},{"code":"AltLeft","type":"event","name":"alt","size":1},{"code":"MetaLeft","type":"event","name":"⌘","size":1},{"code":"Space","type":"event","key":" ","name":"","size":5},{"code":"MetaRight","type":"event","name":"⌘","size":1},{"code":"ArrowLeft","type":"event","name":"⇦","isArrow":true},{"code":"ArrowDown","type":"event","name":"⇩","isArrow":true},{"code":"ArrowRight","type":"event","name":"⇨","isArrow":true}]');class i{constructor(){this.charKeysArr=[],this.keysArr=[],this.container=document.createElement("div"),this.container.classList.add("keyboard__container"),n.forEach((t=>{const n=new e(t);"char"===t.type&&this.charKeysArr.push(n),this.keysArr.push(n),this.container.append(n.container)}));const t=localStorage.getItem("lang");"eng"!==t&&this.changeNames(!1,t)}changeNames(t,e){this.charKeysArr.forEach((n=>{"eng"===e?t&&n.obj.onShift?n.text.textContent=n.obj.onShift:n.text.textContent=n.obj.key:t?n.obj.langOnShift?n.text.textContent=n.obj.langOnShift:n.text.textContent=n.obj.onShift:n.obj.lang?n.text.textContent=n.obj.lang:n.text.textContent=n.obj.key}))}}class s{constructor(){this.container=document.createElement("aside"),this.container.classList.add("hints__container");const t=document.createElement("h2");t.classList.add("hints__title"),t.textContent="Hot Keys",this.list=document.createElement("ul"),this.list.textContent="Change language:",this.list.classList.add("hints__list"),this.createListItem("For Mac: ","Control + ⌘ Command"),this.createListItem("For Windows: ","⇧ Shift + ⎵ Space");const e=document.createElement("p");e.classList.add("hints__text"),e.textContent="Keyboard was made on Mac OS",this.container.append(t,this.list,e)}createListItem(t,e){const n=document.createElement("li");n.classList.add("hints__item");const i=document.createElement("span");i.classList.add("hints__span"),i.textContent=t;const s=document.createElement("p");s.textContent=e,n.append(s),s.prepend(i),this.list.append(n)}}class a{constructor(){this.item=document.createElement("header"),this.item.classList.add("header");const t=document.createElement("h1");t.classList.add("header__title"),t.textContent="Virtual Keyboard";const e=document.createElement("p");e.classList.add("header__note"),e.textContent="Info";const n=new s,i=document.createElement("div");i.classList.add("header__cover"),this.item.append(t,e,n.container,i),e.addEventListener("click",(()=>{n.container.classList.toggle("hints__container_open")}))}}class o{constructor(){this.item=document.createElement("footer"),this.item.classList.add("footer");const t=document.createElement("p");t.classList.add("footer__text"),t.textContent="Layout:  ",this.eng=document.createElement("span"),this.eng.classList.add("footer__span"),this.eng.textContent="eng ",this.croat=document.createElement("span"),this.croat.classList.add("footer__span"),this.croat.textContent="HR/SRB",t.append(this.eng,this.croat);const e=localStorage.getItem("lang");this.lang=e||"eng","eng"!==this.lang?this.croat.classList.add("footer__span_selected"):this.eng.classList.add("footer__span_selected");const n=document.createElement("p");n.classList.add("footer__text","footer__link"),n.textContent="2023",this.item.append(t,n)}onLangChange(t){this.lang=t,this.croat.classList.toggle("footer__span_selected"),this.eng.classList.toggle("footer__span_selected")}}const c=document.querySelector("body"),h=new class{constructor(){this.container=document.createElement("div"),this.container.classList.add("app");const e=localStorage.getItem("lang");this.lang=e||"eng";const n=new a;this.footer=new o,this.textarea=new t,this.keyboard=new i,this.container.append(n.item,this.textarea.container,this.keyboard.container,this.footer.item),this.container.addEventListener("custom-key",(t=>{this.onVirtualKey(t.detail.isCaps,t.detail.obj),this.textarea.input.focus()})),this.container.addEventListener("shift-down",(t=>{this.isCaps=!this.isCaps,this.keyboard.changeNames(this.isCaps,this.lang),this.textarea.input.focus()})),document.addEventListener("keydown",(t=>{t.preventDefault();let e=this.keyboard.keysArr.find((e=>e.obj.code===t.code));"ShiftRight"===t.code&&(e=this.keyboard.keysArr.find((t=>"ShiftLeft"===t.obj.code))),e&&(e.container.classList.add("key__container_clicked"),t.ctrlKey&&t.metaKey||t.shiftKey&&"Space"===t.code?(t.preventDefault(),this.changeLang()):t.key&&(t.preventDefault(),this.onVirtualKey(e.isCaps,e.obj)),"CapsLock"===t.code&&(navigator.userAgent.includes("Mac OS")&&e.container.click(),!navigator.userAgent.includes("Mac OS")&&this.isCaps?this.onVirtualKey(!1,e.obj):this.onVirtualKey(!0,e.obj)),"ShiftLeft"!==t.code&&"ShiftRight"!==t.code||(this.isCaps?this.onVirtualKey(!1,e.obj):this.onVirtualKey(!0,e.obj)))})),document.addEventListener("keyup",(t=>{t.preventDefault();let e=this.keyboard.keysArr.find((e=>e.obj.code===t.code));"ShiftRight"===t.code&&(e=this.keyboard.keysArr.find((t=>"ShiftLeft"===t.obj.code))),e&&(e.container.classList.remove("key__container_clicked"),"CapsLock"===t.code&&navigator.userAgent.includes("Mac OS")&&(e.container.click(),this.onVirtualKey(!1,e.obj)),"ShiftLeft"!==t.code&&"ShiftRight"!==t.code||(this.isCaps?this.onVirtualKey(!1,e.obj):this.onVirtualKey(!0,e.obj)))}))}changeLang(){"eng"===this.lang?this.lang="hr":this.lang="eng",this.footer.onLangChange(this.lang),this.keyboard.changeNames(this.isCaps,this.lang),localStorage.setItem("lang",this.lang)}onVirtualKey(t,e){void 0!==t&&(this.isCaps=t,this.keyboard.changeNames(this.isCaps,this.lang)),this.textarea.addChar(e,this.isCaps,this.lang)}};c.append(h.container)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LGNBQWEsRUFBT0UsRUFBV3hELEtBQy9CM0MsS0FBS2lHLGNBQWEsRUFBTUUsRUFBV3hELE1BRTlDLEdBRUosQ0FFQTZELGFBQ29CLFFBQWR4RyxLQUFLZSxLQUNQZixLQUFLZSxLQUFPLEtBQ1BmLEtBQUtlLEtBQU8sTUFDbkJmLEtBQUs4RixPQUFPTCxhQUFhekYsS0FBS2UsTUFDOUJmLEtBQUtnRyxTQUFTM0IsWUFBWXJFLEtBQUtjLE9BQVFkLEtBQUtlLE1BQzVDb0QsYUFBYTBDLFFBQVEsT0FBUTdHLEtBQUtlLEtBQ3BDLENBRUFrRixhQUFhbkYsRUFBUTZCLFFBQ0pLLElBQVhsQyxJQUNGZCxLQUFLYyxPQUFTQSxFQUNkZCxLQUFLZ0csU0FBUzNCLFlBQVlyRSxLQUFLYyxPQUFRZCxLQUFLZSxPQUU5Q2YsS0FBSytGLFNBQVNuRixRQUFRK0IsRUFBSzNDLEtBQUtjLE9BQVFkLEtBQUtlLEtBQy9DLEdEL0dGMkUsRUFBS2xGLE9BQU9vRixFQUFJM0YsVSIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL3RleHRhcmVhL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9jb21wb25lbnRzL2tleS9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy9rZXlib2FyZC9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy9oaW50cy9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvY29tcG9uZW50cy9oZWFkZXIvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2NvbXBvbmVudHMvZm9vdGVyL2luZGV4LmpzIiwid2VicGFjazovLy8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMvYXBwLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAnLi9zdHlsZS5zY3NzJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUZXh0YXJlYSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLmlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKVxuICAgIHRoaXMuaW5wdXQuc2V0QXR0cmlidXRlKCdzcGVsbGNoZWNrJywgZmFsc2UpXG4gICAgdGhpcy5pbnB1dC5jbGFzc0xpc3QuYWRkKCd0ZXh0YXJlYV9faW5wdXQnKVxuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZCh0aGlzLmlucHV0KVxuXG4gICAgdGhpcy5jdXJzb3IgPSB0aGlzLmlucHV0LnNlbGVjdGlvblN0YXJ0XG4gICAgdGhpcy5pbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIHRoaXMuY3Vyc29yID0gdGhpcy5pbnB1dC5zZWxlY3Rpb25TdGFydFxuICAgIH0pXG4gIH1cblxuICBhZGRDaGFyKGtleUluZm8sIGlzQ2FwcywgbGFuZykge1xuICAgIGlmIChrZXlJbmZvLmtleSkge1xuICAgICAgbGV0IGtleVxuICAgICAgaWYgKGxhbmcgPT09ICdlbmcnKSB7XG4gICAgICAgIGlmIChpc0NhcHMgJiYga2V5SW5mby5vblNoaWZ0KSB7XG4gICAgICAgICAga2V5ID0ga2V5SW5mby5vblNoaWZ0XG4gICAgICAgIH0gZWxzZSBrZXkgPSBrZXlJbmZvLmtleVxuICAgICAgfSBlbHNlIGlmIChpc0NhcHMpIHtcbiAgICAgICAgaWYgKGtleUluZm8ubGFuZ09uU2hpZnQpIHtcbiAgICAgICAgICBrZXkgPSBrZXlJbmZvLmxhbmdPblNoaWZ0XG4gICAgICAgIH0gZWxzZSBpZiAoa2V5SW5mby5vblNoaWZ0KSB7XG4gICAgICAgICAga2V5ID0ga2V5SW5mby5vblNoaWZ0XG4gICAgICAgIH0gZWxzZSBpZiAoa2V5SW5mby5sYW5nKSB7XG4gICAgICAgICAga2V5ID0ga2V5SW5mby5sYW5kXG4gICAgICAgIH0gZWxzZSBrZXkgPSBrZXlJbmZvLmtleVxuICAgICAgfSBlbHNlIGlmIChrZXlJbmZvLmxhbmcpIHtcbiAgICAgICAga2V5ID0ga2V5SW5mby5sYW5nXG4gICAgICB9IGVsc2Uga2V5ID0ga2V5SW5mby5rZXlcblxuICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9XG4gICAgICAgIHRoaXMuaW5wdXQudmFsdWUuc2xpY2UoMCwgdGhpcy5jdXJzb3IpICtcbiAgICAgICAga2V5ICtcbiAgICAgICAgdGhpcy5pbnB1dC52YWx1ZS5zbGljZSh0aGlzLmN1cnNvcilcbiAgICAgIHRoaXMuY3Vyc29yICs9IDFcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGtleUluZm8uY29kZSA9PT0gJ0Fycm93VXAnKSB7XG4gICAgICAgIHRoaXMuc2V0Q3Vyc29yVXAoKVxuICAgICAgfVxuICAgICAgaWYgKGtleUluZm8uY29kZSA9PT0gJ0Fycm93RG93bicpIHtcbiAgICAgICAgdGhpcy5zZXRDdXJzb3JEb3duKClcbiAgICAgIH1cblxuICAgICAgaWYgKGtleUluZm8uY29kZSA9PT0gJ0JhY2tzcGFjZScpIHtcbiAgICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9XG4gICAgICAgICAgdGhpcy5pbnB1dC52YWx1ZS5zbGljZSgwLCB0aGlzLmN1cnNvciAtIDEpICtcbiAgICAgICAgICB0aGlzLmlucHV0LnZhbHVlLnNsaWNlKHRoaXMuY3Vyc29yKVxuICAgICAgICB0aGlzLmN1cnNvciAtPSAxXG4gICAgICB9IGVsc2UgaWYgKGtleUluZm8uY29kZSA9PT0gJ0RlbGV0ZScpIHtcbiAgICAgICAgdGhpcy5pbnB1dC52YWx1ZSA9XG4gICAgICAgICAgdGhpcy5pbnB1dC52YWx1ZS5zbGljZSgwLCB0aGlzLmN1cnNvcikgK1xuICAgICAgICAgIHRoaXMuaW5wdXQudmFsdWUuc2xpY2UodGhpcy5jdXJzb3IgKyAxKVxuICAgICAgfSBlbHNlIGlmIChrZXlJbmZvLmNvZGUgPT09ICdBcnJvd0xlZnQnKSB7XG4gICAgICAgIHRoaXMubW92ZUN1cnNvcignbGVmdCcpXG4gICAgICB9IGVsc2UgaWYgKGtleUluZm8uY29kZSA9PT0gJ0Fycm93UmlnaHQnKSB7XG4gICAgICAgIHRoaXMubW92ZUN1cnNvcigncmlnaHQnKVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc2V0Rm9jdXMoKVxuICB9XG5cbiAgc2V0Q3Vyc29yVXAoKSB7XG4gICAgY29uc3QgbGluZVN0YXJ0ID0gdGhpcy5pbnB1dC52YWx1ZS5sYXN0SW5kZXhPZignXFxuJywgdGhpcy5jdXJzb3IgLSAxKVxuICAgIGNvbnN0IGdhcCA9IHRoaXMuY3Vyc29yIC0gbGluZVN0YXJ0XG4gICAgaWYgKGdhcCA+PSA5NSB8fCAobGluZVN0YXJ0ID09PSAtMSAmJiB0aGlzLmlucHV0LnZhbHVlLmxlbmd0aCA+IDk1KSkge1xuICAgICAgdGhpcy5jdXJzb3IgLT0gOTVcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGxpbmVTdGFydCA9PT0gLTEpIHtcbiAgICAgICAgdGhpcy5jdXJzb3IgPSAwXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBwcmV2TGluZVN0YXJ0ID0gdGhpcy5pbnB1dC52YWx1ZS5sYXN0SW5kZXhPZignXFxuJywgbGluZVN0YXJ0IC0gMSlcbiAgICAgICAgY29uc3QgcHJldkxpbmVMZW5ndGggPSBsaW5lU3RhcnQgLSBwcmV2TGluZVN0YXJ0XG4gICAgICAgIGlmIChwcmV2TGluZUxlbmd0aCA8IGdhcCkge1xuICAgICAgICAgIHRoaXMuY3Vyc29yID0gbGluZVN0YXJ0XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5jdXJzb3IgPSBwcmV2TGluZVN0YXJ0ICsgZ2FwXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmlucHV0LnNldFNlbGVjdGlvblJhbmdlKHRoaXMuY3Vyc29yLCB0aGlzLmN1cnNvcilcbiAgfVxuXG4gIHNldEN1cnNvckRvd24oKSB7XG4gICAgY29uc3QgbGluZVN0YXJ0ID0gdGhpcy5pbnB1dC52YWx1ZS5sYXN0SW5kZXhPZignXFxuJywgdGhpcy5jdXJzb3IgLSAxKVxuICAgIGNvbnN0IGdhcCA9IHRoaXMuY3Vyc29yIC0gbGluZVN0YXJ0XG4gICAgY29uc3QgbmV4dExpbmVTdGFydCA9IHRoaXMuaW5wdXQudmFsdWUuaW5kZXhPZignXFxuJywgbGluZVN0YXJ0ICsgMSlcbiAgICBpZiAoZ2FwID49IDk1IHx8IChsaW5lU3RhcnQgPT09IC0xICYmIHRoaXMuaW5wdXQudmFsdWUubGVuZ3RoID4gOTUpKSB7XG4gICAgICB0aGlzLmN1cnNvciArPSA5NVxuICAgIH0gZWxzZSBpZiAobmV4dExpbmVTdGFydCA9PT0gLTEpIHtcbiAgICAgIHRoaXMuY3Vyc29yID0gdGhpcy5pbnB1dC52YWx1ZS5sZW5ndGhcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGFmdGVyTmV4dExpbmUgPSB0aGlzLmlucHV0LnZhbHVlLmluZGV4T2YoJ1xcbicsIG5leHRMaW5lU3RhcnQgKyAxKVxuICAgICAgaWYgKGFmdGVyTmV4dExpbmUgPT09IC0xKSB7XG4gICAgICAgIGFmdGVyTmV4dExpbmUgPSB0aGlzLmlucHV0LnZhbHVlLmxlbmd0aFxuICAgICAgfVxuICAgICAgY29uc3QgbmV4dExpbmVMZW5ndGggPSBhZnRlck5leHRMaW5lIC0gbmV4dExpbmVTdGFydFxuICAgICAgaWYgKG5leHRMaW5lTGVuZ3RoIDwgZ2FwKSB7XG4gICAgICAgIHRoaXMuY3Vyc29yID0gbmV4dExpbmVTdGFydCArIG5leHRMaW5lTGVuZ3RoXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmN1cnNvciA9IG5leHRMaW5lU3RhcnQgKyBnYXBcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmlucHV0LnNldFNlbGVjdGlvblJhbmdlKHRoaXMuY3Vyc29yLCB0aGlzLmN1cnNvcilcbiAgfVxuXG4gIHNldEZvY3VzKCkge1xuICAgIHRoaXMuaW5wdXQuZm9jdXMoKVxuICAgIHRoaXMuaW5wdXQuc2VsZWN0aW9uU3RhcnQgPSB0aGlzLmN1cnNvclxuICAgIHRoaXMuaW5wdXQuc2VsZWN0aW9uRW5kID0gdGhpcy5jdXJzb3JcbiAgfVxuXG4gIG1vdmVDdXJzb3Ioc2lkZSkge1xuICAgIGlmIChzaWRlID09PSAnbGVmdCcpIHtcbiAgICAgIHRoaXMuY3Vyc29yIC09IDFcbiAgICB9IGVsc2UgdGhpcy5jdXJzb3IgKz0gMVxuICAgIHRoaXMuc2V0Rm9jdXMoKVxuICB9XG59XG4iLCJpbXBvcnQgJy4vc3R5bGUuc2NzcydcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgS2V5IHtcbiAgY29uc3RydWN0b3Ioa2V5T2JqKSB7XG4gICAgdGhpcy5vYmogPSBrZXlPYmpcbiAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgna2V5X19jb250YWluZXInKVxuICAgIHRoaXMuZmFjZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy5mYWNlLmNsYXNzTGlzdC5hZGQoJ2tleV9fZmFjZScpXG4gICAgdGhpcy50ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpXG4gICAgdGhpcy50ZXh0LmNsYXNzTGlzdC5hZGQoJ2tleV9fdGV4dCcpXG4gICAgaWYgKGtleU9iai50eXBlID09PSAnY2hhcicpIHtcbiAgICAgIHRoaXMudGV4dC50ZXh0Q29udGVudCA9IGtleU9iai5rZXlcbiAgICB9IGVsc2UgaWYgKGtleU9iai5uYW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMudGV4dC50ZXh0Q29udGVudCA9IGtleU9iai5uYW1lXG4gICAgfSBlbHNlIHRoaXMudGV4dC50ZXh0Q29udGVudCA9IGtleU9iai5jb2RlXG4gICAgdGhpcy5mYWNlLmFwcGVuZCh0aGlzLnRleHQpXG4gICAgc3dpdGNoIChrZXlPYmouc2l6ZSkge1xuICAgICAgY2FzZSAyOlxuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdrZXlfX2NvbnRhaW5lcl9zJylcbiAgICAgICAgYnJlYWtcbiAgICAgIGNhc2UgMzpcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgna2V5X19jb250YWluZXJfZXZlbnRfbScpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlIDQ6XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2tleV9fY29udGFpbmVyX2V2ZW50X2wnKVxuICAgICAgICBicmVha1xuICAgICAgY2FzZSA1OlxuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdrZXlfX2NvbnRhaW5lcl9ldmVudF94bCcpXG4gICAgICAgIGJyZWFrXG4gICAgICBjYXNlIDE6XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2tleV9fY29udGFpbmVyX3hzJylcbiAgICAgICAgYnJlYWtcbiAgICB9XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kKHRoaXMuZmFjZSlcbiAgICBpZiAoa2V5T2JqLnR5cGUgPT09ICdldmVudCcpIHtcbiAgICAgIGlmIChrZXlPYmouaXNBcnJvdykge1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdrZXlfX2NvbnRhaW5lcl9hcnJvdycpXG4gICAgICB9IGVsc2UgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LmFkZCgna2V5X19jb250YWluZXJfZXZlbnQnKVxuICAgIH1cblxuICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgaWYgKGtleU9iai5jb2RlID09PSAnQ2Fwc0xvY2snKSB7XG4gICAgICAgIHRoaXMuc2V0T25Nb2RlKClcbiAgICAgIH1cbiAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdjdXN0b20ta2V5Jywge1xuICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICBkZXRhaWw6IHsgb2JqOiBrZXlPYmosIGlzQ2FwczogdGhpcy5pc0NhcHMgfSxcbiAgICAgIH0pXG4gICAgICB0aGlzLmNvbnRhaW5lci5kaXNwYXRjaEV2ZW50KGV2ZW50KVxuICAgIH0pXG5cbiAgICB0aGlzLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCAoKSA9PiB7XG4gICAgICB0aGlzLmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdrZXlfX2NvbnRhaW5lcl9jbGlja2VkJylcbiAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2tleV9fZmFjZV9jbGlja2VkJylcbiAgICAgIHRoaXMudG9nZ2xlU2hpZnQoa2V5T2JqKVxuICAgIH0pXG5cbiAgICB0aGlzLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgKCkgPT4ge1xuICAgICAgdGhpcy50b2dnbGVTaGlmdChrZXlPYmopXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgna2V5X19jb250YWluZXJfY2xpY2tlZCcpXG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2tleV9fZmFjZV9jbGlja2VkJylcbiAgICAgIH0sIDEwMClcbiAgICB9KVxuICB9XG5cbiAgc2V0T25Nb2RlKCkge1xuICAgIHRoaXMuZmFjZS5jbGFzc0xpc3QudG9nZ2xlKCdrZXlfX2ZhY2Vfb24nKVxuICAgIGlmICh0aGlzLmlzQ2Fwcykge1xuICAgICAgdGhpcy5pc0NhcHMgPSBmYWxzZVxuICAgIH0gZWxzZSB0aGlzLmlzQ2FwcyA9IHRydWVcbiAgfVxuXG4gIHRvZ2dsZVNoaWZ0KGtleU9iaikge1xuICAgIGlmIChrZXlPYmouY29kZSA9PT0gJ1NoaWZ0TGVmdCcpIHtcbiAgICAgIGNvbnN0IGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KCdzaGlmdC1kb3duJywge1xuICAgICAgICBidWJibGVzOiB0cnVlLFxuICAgICAgICBkZXRhaWw6IHsgb2JqOiBrZXlPYmogfSxcbiAgICAgIH0pXG4gICAgICB0aGlzLmNvbnRhaW5lci5kaXNwYXRjaEV2ZW50KGV2ZW50KVxuICAgIH1cbiAgfVxufVxuIiwiaW1wb3J0ICcuL3N0eWxlLnNjc3MnXG5pbXBvcnQgS2V5IGZyb20gJy4uL2tleSdcbmltcG9ydCBrZXlzIGZyb20gJy4va2V5cy5qc29uJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBLZXlib2FyZCB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY2hhcktleXNBcnIgPSBbXVxuICAgIHRoaXMua2V5c0FyciA9IFtdXG4gICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2tleWJvYXJkX19jb250YWluZXInKVxuICAgIGtleXMuZm9yRWFjaChlID0+IHtcbiAgICAgIGNvbnN0IGtleSA9IG5ldyBLZXkoZSlcbiAgICAgIGlmIChlLnR5cGUgPT09ICdjaGFyJykge1xuICAgICAgICB0aGlzLmNoYXJLZXlzQXJyLnB1c2goa2V5KVxuICAgICAgfVxuICAgICAgdGhpcy5rZXlzQXJyLnB1c2goa2V5KVxuICAgICAgdGhpcy5jb250YWluZXIuYXBwZW5kKGtleS5jb250YWluZXIpXG4gICAgfSlcbiAgICBjb25zdCBsYW5nID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2xhbmcnKVxuICAgIGlmIChsYW5nICE9PSAnZW5nJykgdGhpcy5jaGFuZ2VOYW1lcyhmYWxzZSwgbGFuZylcbiAgfVxuXG4gIGNoYW5nZU5hbWVzKGlzQ2FwcywgbGFuZykge1xuICAgIHRoaXMuY2hhcktleXNBcnIuZm9yRWFjaChlID0+IHtcbiAgICAgIGlmIChsYW5nID09PSAnZW5nJykge1xuICAgICAgICBpZiAoaXNDYXBzICYmIGUub2JqLm9uU2hpZnQpIHtcbiAgICAgICAgICBlLnRleHQudGV4dENvbnRlbnQgPSBlLm9iai5vblNoaWZ0XG4gICAgICAgIH0gZWxzZSBlLnRleHQudGV4dENvbnRlbnQgPSBlLm9iai5rZXlcbiAgICAgIH0gZWxzZSBpZiAoaXNDYXBzKSB7XG4gICAgICAgIGlmIChlLm9iai5sYW5nT25TaGlmdCkge1xuICAgICAgICAgIGUudGV4dC50ZXh0Q29udGVudCA9IGUub2JqLmxhbmdPblNoaWZ0XG4gICAgICAgIH0gZWxzZSBlLnRleHQudGV4dENvbnRlbnQgPSBlLm9iai5vblNoaWZ0XG4gICAgICB9IGVsc2UgaWYgKGUub2JqLmxhbmcpIHtcbiAgICAgICAgZS50ZXh0LnRleHRDb250ZW50ID0gZS5vYmoubGFuZ1xuICAgICAgfSBlbHNlIGUudGV4dC50ZXh0Q29udGVudCA9IGUub2JqLmtleVxuICAgIH0pXG4gIH1cbn1cbiIsImltcG9ydCAnLi9zdHlsZS5zY3NzJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBIaW50cyB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYXNpZGUnKVxuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2hpbnRzX19jb250YWluZXInKVxuICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKVxuICAgIHRpdGxlLmNsYXNzTGlzdC5hZGQoJ2hpbnRzX190aXRsZScpXG4gICAgdGl0bGUudGV4dENvbnRlbnQgPSAnSG90IEtleXMnXG4gICAgdGhpcy5saXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKVxuICAgIHRoaXMubGlzdC50ZXh0Q29udGVudCA9ICdDaGFuZ2UgbGFuZ3VhZ2U6J1xuICAgIHRoaXMubGlzdC5jbGFzc0xpc3QuYWRkKCdoaW50c19fbGlzdCcpXG4gICAgdGhpcy5jcmVhdGVMaXN0SXRlbSgnRm9yIE1hYzogJywgJ0NvbnRyb2wgKyDijJggQ29tbWFuZCcpXG4gICAgdGhpcy5jcmVhdGVMaXN0SXRlbSgnRm9yIFdpbmRvd3M6ICcsICfih6cgU2hpZnQgKyDijrUgU3BhY2UnKVxuICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJylcbiAgICB0ZXh0LmNsYXNzTGlzdC5hZGQoJ2hpbnRzX190ZXh0JylcbiAgICB0ZXh0LnRleHRDb250ZW50ID0gJ0tleWJvYXJkIHdhcyBtYWRlIG9uIE1hYyBPUydcbiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmQodGl0bGUsIHRoaXMubGlzdCwgdGV4dClcbiAgfVxuXG4gIGNyZWF0ZUxpc3RJdGVtKGZpcnN0VGV4dCwgc2Vjb25kVGV4dCkge1xuICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpXG4gICAgaXRlbS5jbGFzc0xpc3QuYWRkKCdoaW50c19faXRlbScpXG4gICAgY29uc3Qgc3BhbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxuICAgIHNwYW4uY2xhc3NMaXN0LmFkZCgnaGludHNfX3NwYW4nKVxuICAgIHNwYW4udGV4dENvbnRlbnQgPSBmaXJzdFRleHRcbiAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpXG4gICAgdGV4dC50ZXh0Q29udGVudCA9IHNlY29uZFRleHRcbiAgICBpdGVtLmFwcGVuZCh0ZXh0KVxuICAgIHRleHQucHJlcGVuZChzcGFuKVxuICAgIHRoaXMubGlzdC5hcHBlbmQoaXRlbSlcbiAgfVxufVxuIiwiaW1wb3J0ICcuL3N0eWxlLnNjc3MnXG5pbXBvcnQgSGludHMgZnJvbSAnLi4vaGludHMnXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEhlYWRlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaXRlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2hlYWRlcicpXG4gICAgdGhpcy5pdGVtLmNsYXNzTGlzdC5hZGQoJ2hlYWRlcicpXG4gICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMScpXG4gICAgdGl0bGUuY2xhc3NMaXN0LmFkZCgnaGVhZGVyX190aXRsZScpXG4gICAgdGl0bGUudGV4dENvbnRlbnQgPSAnVmlydHVhbCBLZXlib2FyZCdcbiAgICBjb25zdCBub3RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpXG4gICAgbm90ZS5jbGFzc0xpc3QuYWRkKCdoZWFkZXJfX25vdGUnKVxuICAgIG5vdGUudGV4dENvbnRlbnQgPSAnSW5mbydcbiAgICBjb25zdCBoaW50cyA9IG5ldyBIaW50cygpXG4gICAgY29uc3QgY292ZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgIGNvdmVyLmNsYXNzTGlzdC5hZGQoJ2hlYWRlcl9fY292ZXInKVxuICAgIHRoaXMuaXRlbS5hcHBlbmQodGl0bGUsIG5vdGUsIGhpbnRzLmNvbnRhaW5lciwgY292ZXIpXG4gICAgbm90ZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIGhpbnRzLmNvbnRhaW5lci5jbGFzc0xpc3QudG9nZ2xlKCdoaW50c19fY29udGFpbmVyX29wZW4nKVxuICAgIH0pXG4gIH1cbn1cbiIsImltcG9ydCAnLi9zdHlsZS5zY3NzJ1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBGb290ZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLml0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdmb290ZXInKVxuICAgIHRoaXMuaXRlbS5jbGFzc0xpc3QuYWRkKCdmb290ZXInKVxuICAgIGNvbnN0IHRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJylcbiAgICB0ZXh0LmNsYXNzTGlzdC5hZGQoJ2Zvb3Rlcl9fdGV4dCcpXG4gICAgdGV4dC50ZXh0Q29udGVudCA9ICdMYXlvdXQ6ICAnXG4gICAgdGhpcy5lbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJylcbiAgICB0aGlzLmVuZy5jbGFzc0xpc3QuYWRkKCdmb290ZXJfX3NwYW4nKVxuICAgIHRoaXMuZW5nLnRleHRDb250ZW50ID0gJ2VuZyAnXG4gICAgdGhpcy5jcm9hdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKVxuICAgIHRoaXMuY3JvYXQuY2xhc3NMaXN0LmFkZCgnZm9vdGVyX19zcGFuJylcbiAgICB0aGlzLmNyb2F0LnRleHRDb250ZW50ID0gJ0hSL1NSQidcbiAgICB0ZXh0LmFwcGVuZCh0aGlzLmVuZywgdGhpcy5jcm9hdClcbiAgICBjb25zdCBwcmV2TGFuZyA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdsYW5nJylcbiAgICBpZiAocHJldkxhbmcpIHtcbiAgICAgIHRoaXMubGFuZyA9IHByZXZMYW5nXG4gICAgfSBlbHNlIHRoaXMubGFuZyA9ICdlbmcnXG4gICAgaWYgKHRoaXMubGFuZyAhPT0gJ2VuZycpIHtcbiAgICAgIHRoaXMuY3JvYXQuY2xhc3NMaXN0LmFkZCgnZm9vdGVyX19zcGFuX3NlbGVjdGVkJylcbiAgICB9IGVsc2UgdGhpcy5lbmcuY2xhc3NMaXN0LmFkZCgnZm9vdGVyX19zcGFuX3NlbGVjdGVkJylcbiAgICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpXG4gICAgZGF0ZS5jbGFzc0xpc3QuYWRkKCdmb290ZXJfX3RleHQnLCAnZm9vdGVyX19saW5rJylcbiAgICBkYXRlLnRleHRDb250ZW50ID0gJzIwMjMnXG4gICAgdGhpcy5pdGVtLmFwcGVuZCh0ZXh0LCBkYXRlKVxuICB9XG5cbiAgb25MYW5nQ2hhbmdlKGxhbmcpIHtcbiAgICB0aGlzLmxhbmcgPSBsYW5nXG4gICAgdGhpcy5jcm9hdC5jbGFzc0xpc3QudG9nZ2xlKCdmb290ZXJfX3NwYW5fc2VsZWN0ZWQnKVxuICAgIHRoaXMuZW5nLmNsYXNzTGlzdC50b2dnbGUoJ2Zvb3Rlcl9fc3Bhbl9zZWxlY3RlZCcpXG4gIH1cbn1cbiIsImltcG9ydCAnLi9zdHlsZS5zY3NzJ1xuaW1wb3J0IEFwcCBmcm9tICcuL2FwcCdcblxuY29uc3Qgcm9vdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKVxuY29uc3QgYXBwID0gbmV3IEFwcCgpXG5yb290LmFwcGVuZChhcHAuY29udGFpbmVyKVxuIiwiaW1wb3J0ICcuL3N0eWxlLnNjc3MnXG5pbXBvcnQgVGV4dGFyZWEgZnJvbSAnLi9jb21wb25lbnRzL3RleHRhcmVhJ1xuaW1wb3J0IEtleWJvYXJkIGZyb20gJy4vY29tcG9uZW50cy9rZXlib2FyZCdcbmltcG9ydCBIZWFkZXIgZnJvbSAnLi9jb21wb25lbnRzL2hlYWRlcidcbmltcG9ydCBGb290ZXIgZnJvbSAnLi9jb21wb25lbnRzL2Zvb3RlcidcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBwIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgIHRoaXMuY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2FwcCcpXG4gICAgY29uc3QgcHJldkxhbmcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbGFuZycpXG4gICAgaWYgKHByZXZMYW5nKSB7XG4gICAgICB0aGlzLmxhbmcgPSBwcmV2TGFuZ1xuICAgIH0gZWxzZSB0aGlzLmxhbmcgPSAnZW5nJ1xuXG4gICAgY29uc3QgaGVhZGVyID0gbmV3IEhlYWRlcigpXG4gICAgdGhpcy5mb290ZXIgPSBuZXcgRm9vdGVyKClcblxuICAgIHRoaXMudGV4dGFyZWEgPSBuZXcgVGV4dGFyZWEoKVxuICAgIHRoaXMua2V5Ym9hcmQgPSBuZXcgS2V5Ym9hcmQoKVxuXG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kKFxuICAgICAgaGVhZGVyLml0ZW0sXG4gICAgICB0aGlzLnRleHRhcmVhLmNvbnRhaW5lcixcbiAgICAgIHRoaXMua2V5Ym9hcmQuY29udGFpbmVyLFxuICAgICAgdGhpcy5mb290ZXIuaXRlbVxuICAgIClcblxuICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2N1c3RvbS1rZXknLCBlID0+IHtcbiAgICAgIHRoaXMub25WaXJ0dWFsS2V5KGUuZGV0YWlsLmlzQ2FwcywgZS5kZXRhaWwub2JqKVxuICAgICAgdGhpcy50ZXh0YXJlYS5pbnB1dC5mb2N1cygpXG4gICAgfSlcblxuICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3NoaWZ0LWRvd24nLCBlID0+IHtcbiAgICAgIHRoaXMuaXNDYXBzID0gIXRoaXMuaXNDYXBzXG4gICAgICB0aGlzLmtleWJvYXJkLmNoYW5nZU5hbWVzKHRoaXMuaXNDYXBzLCB0aGlzLmxhbmcpXG4gICAgICB0aGlzLnRleHRhcmVhLmlucHV0LmZvY3VzKClcbiAgICB9KVxuXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGV2ZW50ID0+IHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBsZXQgdmlydHVhbEtleSA9IHRoaXMua2V5Ym9hcmQua2V5c0Fyci5maW5kKFxuICAgICAgICBlID0+IGUub2JqLmNvZGUgPT09IGV2ZW50LmNvZGVcbiAgICAgIClcbiAgICAgIGlmIChldmVudC5jb2RlID09PSAnU2hpZnRSaWdodCcpIHtcbiAgICAgICAgdmlydHVhbEtleSA9IHRoaXMua2V5Ym9hcmQua2V5c0Fyci5maW5kKGUgPT4gZS5vYmouY29kZSA9PT0gJ1NoaWZ0TGVmdCcpXG4gICAgICB9XG4gICAgICBpZiAodmlydHVhbEtleSkge1xuICAgICAgICB2aXJ0dWFsS2V5LmNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdrZXlfX2NvbnRhaW5lcl9jbGlja2VkJylcbiAgICAgICAgaWYgKFxuICAgICAgICAgIChldmVudC5jdHJsS2V5ICYmIGV2ZW50Lm1ldGFLZXkpIHx8XG4gICAgICAgICAgKGV2ZW50LnNoaWZ0S2V5ICYmIGV2ZW50LmNvZGUgPT09ICdTcGFjZScpXG4gICAgICAgICkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICB0aGlzLmNoYW5nZUxhbmcoKVxuICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmtleSkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KClcbiAgICAgICAgICB0aGlzLm9uVmlydHVhbEtleSh2aXJ0dWFsS2V5LmlzQ2FwcywgdmlydHVhbEtleS5vYmopXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV2ZW50LmNvZGUgPT09ICdDYXBzTG9jaycpIHtcbiAgICAgICAgICBpZihuYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKFwiTWFjIE9TXCIpKVxuICAgICAgICAgIHZpcnR1YWxLZXkuY29udGFpbmVyLmNsaWNrKClcbiAgICAgICAgICBpZighbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmNsdWRlcyhcIk1hYyBPU1wiKSYmKHRoaXMuaXNDYXBzKSkge1xuICAgICAgICAgICAgdGhpcy5vblZpcnR1YWxLZXkoZmFsc2UsIHZpcnR1YWxLZXkub2JqKVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5vblZpcnR1YWxLZXkodHJ1ZSwgdmlydHVhbEtleS5vYmopfVxuICAgICAgICB9XG4gICAgICAgIGlmIChldmVudC5jb2RlID09PSAnU2hpZnRMZWZ0JyB8fCBldmVudC5jb2RlID09PSAnU2hpZnRSaWdodCcpIHtcbiAgICAgICAgICBpZiAodGhpcy5pc0NhcHMpIHtcbiAgICAgICAgICAgIHRoaXMub25WaXJ0dWFsS2V5KGZhbHNlLCB2aXJ0dWFsS2V5Lm9iailcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5vblZpcnR1YWxLZXkodHJ1ZSwgdmlydHVhbEtleS5vYmopXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcblxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZXZlbnQgPT4ge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGxldCB2aXJ0dWFsS2V5ID0gdGhpcy5rZXlib2FyZC5rZXlzQXJyLmZpbmQoXG4gICAgICAgIGUgPT4gZS5vYmouY29kZSA9PT0gZXZlbnQuY29kZVxuICAgICAgKVxuICAgICAgaWYgKGV2ZW50LmNvZGUgPT09ICdTaGlmdFJpZ2h0Jykge1xuICAgICAgICB2aXJ0dWFsS2V5ID0gdGhpcy5rZXlib2FyZC5rZXlzQXJyLmZpbmQoZSA9PiBlLm9iai5jb2RlID09PSAnU2hpZnRMZWZ0JylcbiAgICAgIH1cbiAgICAgIGlmICh2aXJ0dWFsS2V5KSB7XG4gICAgICAgIHZpcnR1YWxLZXkuY29udGFpbmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2tleV9fY29udGFpbmVyX2NsaWNrZWQnKVxuICAgICAgICBpZiAoZXZlbnQuY29kZSA9PT0gJ0NhcHNMb2NrJykge1xuICAgICAgICAgIGlmKG5hdmlnYXRvci51c2VyQWdlbnQuaW5jbHVkZXMoXCJNYWMgT1NcIikpe1xuICAgICAgICAgIHZpcnR1YWxLZXkuY29udGFpbmVyLmNsaWNrKClcbiAgICAgICAgICB0aGlzLm9uVmlydHVhbEtleShmYWxzZSwgdmlydHVhbEtleS5vYmopfVxuICAgICAgICB9XG4gICAgICAgIGlmIChldmVudC5jb2RlID09PSAnU2hpZnRMZWZ0JyB8fCBldmVudC5jb2RlID09PSAnU2hpZnRSaWdodCcpIHtcbiAgICAgICAgICBpZiAodGhpcy5pc0NhcHMpIHtcbiAgICAgICAgICAgIHRoaXMub25WaXJ0dWFsS2V5KGZhbHNlLCB2aXJ0dWFsS2V5Lm9iailcbiAgICAgICAgICB9IGVsc2UgdGhpcy5vblZpcnR1YWxLZXkodHJ1ZSwgdmlydHVhbEtleS5vYmopXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICB9XG5cbiAgY2hhbmdlTGFuZygpIHtcbiAgICBpZiAodGhpcy5sYW5nID09PSAnZW5nJykge1xuICAgICAgdGhpcy5sYW5nID0gJ2hyJ1xuICAgIH0gZWxzZSB0aGlzLmxhbmcgPSAnZW5nJ1xuICAgIHRoaXMuZm9vdGVyLm9uTGFuZ0NoYW5nZSh0aGlzLmxhbmcpXG4gICAgdGhpcy5rZXlib2FyZC5jaGFuZ2VOYW1lcyh0aGlzLmlzQ2FwcywgdGhpcy5sYW5nKVxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdsYW5nJywgdGhpcy5sYW5nKVxuICB9XG5cbiAgb25WaXJ0dWFsS2V5KGlzQ2Fwcywgb2JqKSB7XG4gICAgaWYgKGlzQ2FwcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLmlzQ2FwcyA9IGlzQ2Fwc1xuICAgICAgdGhpcy5rZXlib2FyZC5jaGFuZ2VOYW1lcyh0aGlzLmlzQ2FwcywgdGhpcy5sYW5nKVxuICAgIH1cbiAgICB0aGlzLnRleHRhcmVhLmFkZENoYXIob2JqLCB0aGlzLmlzQ2FwcywgdGhpcy5sYW5nKVxuICB9XG59XG4iXSwibmFtZXMiOlsiVGV4dGFyZWEiLCJjb25zdHJ1Y3RvciIsInRoaXMiLCJjb250YWluZXIiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbnB1dCIsInNldEF0dHJpYnV0ZSIsImNsYXNzTGlzdCIsImFkZCIsImFwcGVuZCIsImN1cnNvciIsInNlbGVjdGlvblN0YXJ0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImFkZENoYXIiLCJrZXlJbmZvIiwiaXNDYXBzIiwibGFuZyIsImtleSIsIm9uU2hpZnQiLCJsYW5nT25TaGlmdCIsImxhbmQiLCJ2YWx1ZSIsInNsaWNlIiwiY29kZSIsInNldEN1cnNvclVwIiwic2V0Q3Vyc29yRG93biIsIm1vdmVDdXJzb3IiLCJzZXRGb2N1cyIsImxpbmVTdGFydCIsImxhc3RJbmRleE9mIiwiZ2FwIiwibGVuZ3RoIiwicHJldkxpbmVTdGFydCIsInByZXZMaW5lTGVuZ3RoIiwic2V0U2VsZWN0aW9uUmFuZ2UiLCJuZXh0TGluZVN0YXJ0IiwiaW5kZXhPZiIsImFmdGVyTmV4dExpbmUiLCJuZXh0TGluZUxlbmd0aCIsImZvY3VzIiwic2VsZWN0aW9uRW5kIiwic2lkZSIsIktleSIsImtleU9iaiIsIm9iaiIsImZhY2UiLCJ0ZXh0IiwidHlwZSIsInRleHRDb250ZW50IiwidW5kZWZpbmVkIiwibmFtZSIsInNpemUiLCJpc0Fycm93Iiwic2V0T25Nb2RlIiwiZXZlbnQiLCJDdXN0b21FdmVudCIsImJ1YmJsZXMiLCJkZXRhaWwiLCJkaXNwYXRjaEV2ZW50IiwidG9nZ2xlU2hpZnQiLCJzZXRUaW1lb3V0IiwicmVtb3ZlIiwidG9nZ2xlIiwiS2V5Ym9hcmQiLCJjaGFyS2V5c0FyciIsImtleXNBcnIiLCJlIiwicHVzaCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJjaGFuZ2VOYW1lcyIsImZvckVhY2giLCJIaW50cyIsInRpdGxlIiwibGlzdCIsImNyZWF0ZUxpc3RJdGVtIiwiZmlyc3RUZXh0Iiwic2Vjb25kVGV4dCIsIml0ZW0iLCJzcGFuIiwicHJlcGVuZCIsIkhlYWRlciIsIm5vdGUiLCJoaW50cyIsImNvdmVyIiwiRm9vdGVyIiwiZW5nIiwiY3JvYXQiLCJwcmV2TGFuZyIsImRhdGUiLCJvbkxhbmdDaGFuZ2UiLCJyb290IiwicXVlcnlTZWxlY3RvciIsImFwcCIsImhlYWRlciIsImZvb3RlciIsInRleHRhcmVhIiwia2V5Ym9hcmQiLCJvblZpcnR1YWxLZXkiLCJwcmV2ZW50RGVmYXVsdCIsInZpcnR1YWxLZXkiLCJmaW5kIiwiY3RybEtleSIsIm1ldGFLZXkiLCJzaGlmdEtleSIsImNoYW5nZUxhbmciLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJpbmNsdWRlcyIsImNsaWNrIiwic2V0SXRlbSJdLCJzb3VyY2VSb290IjoiIn0=